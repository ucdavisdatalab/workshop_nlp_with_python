
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2. Text Annotation with spaCy &#8212; Natural Language Processing with Python</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >let toggleHintShow = 'Click to show';</script>
    <script >let toggleHintHide = 'Click to hide';</script>
    <script >let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Classification and Feature Engineering" href="03_classification-and-feature-engineering.html" />
    <link rel="prev" title="1. Logistics" href="01_logistics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/datalab-logo-full-color-rgb.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Natural Language Processing with Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   Overview
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_logistics.html">
   1. Logistics
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. Text Annotation with spaCy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_classification-and-feature-engineering.html">
   3. Classification and Feature Engineering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_word-embeddings.html">
   4. Word Embeddings
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/02_text-annotation-with-spacy.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ucdavisdatalab/workshop_nlp_with_python"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ucdavisdatalab/workshop_nlp_with_python/issues/new?title=Issue%20on%20page%20%2F02_text-annotation-with-spacy.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ucdavisdatalab/workshop_nlp_with_python/master?urlpath=tree/02_text-annotation-with-spacy.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spacy-language-models">
   2.1. spaCy Language Models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#annotations">
   2.2. Annotations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#document-annotations">
     2.2.1. Document Annotations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#token-annotations">
     2.2.2. Token Annotations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-of-speech-tagging">
   2.3. Part-of-Speech Tagging
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dependency-parsing">
   2.4. Dependency Parsing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#putting-everything-together">
   2.5. Putting Everything Together
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-lemmas">
     2.5.1. Finding lemmas
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verb-subject-relations">
     2.5.2. Verb-subject relations
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="text-annotation-with-spacy">
<h1><span class="section-number">2. </span>Text Annotation with spaCy<a class="headerlink" href="#text-annotation-with-spacy" title="Permalink to this headline">¶</a></h1>
<p>TODO: introduce language models and spaCy’s take on them</p>
<div class="admonition-learning-objectives admonition">
<p class="admonition-title">Learning objectives</p>
<p>By the end of this chapter, you will be able to:</p>
<ul class="simple">
<li><p>Explain how document annotation differs from other representations of text data</p></li>
<li><p>Have a general sense of how <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> models and their respective pipelines work</p></li>
<li><p>Extract linguistic information about text using <code class="docutils literal notranslate"><span class="pre">spaCy</span></code></p></li>
<li><p>Describe key terms in NLP, like part-of-speech tagging, dependency parsing, etc.</p></li>
<li><p>Know how/where to look for more information about the linguistic data <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> makes available</p></li>
</ul>
</div>
<div class="section" id="spacy-language-models">
<h2><span class="section-number">2.1. </span>spaCy Language Models<a class="headerlink" href="#spacy-language-models" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;en_core_web_md&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="annotations">
<h2><span class="section-number">2.2. </span>Annotations<a class="headerlink" href="#annotations" title="Permalink to this headline">¶</a></h2>
<p>To annotate a document with the <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> model, simply run it through the core function, <code class="docutils literal notranslate"><span class="pre">nlp()</span></code>. We’ll do so with a short poem by Gertrude Stein.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/session_one/stein_carafe.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">stein_poem</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    
<span class="n">carafe</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">stein_poem</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With this done, we can inspect the result…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A kind in glass and a cousin, a spectacle and nothing strange a single hurt color and an arrangement in a system to pointing. All this and not ordinary, not unordered in not resembling. The difference is spreading.
</pre></div>
</div>
</div>
</div>
<p>…which seems to be no different from a string representation! This output is a bit misleading, however. Our <code class="docutils literal notranslate"><span class="pre">carafe</span></code> object actually has a ton of extra information associated with it, even though, on the surface, it appears to be a plain old string.</p>
<p>If you’d like, you can inspect all these attributes and methods with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">carafe</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We won’t show them all here, but suffice it to say, there are a lot!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of attributes in a SpaCy doc:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of attributes in a SpaCy doc: 51
</pre></div>
</div>
</div>
</div>
<p>This high number of attributes indicates an important point to keep in mind when working with <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>: as opposed to other forms of text preprocessing, like changing the case of tokens, removing punctuation, or stemming a corpus, <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> aims to <strong>maximally preserve information</strong> about your document. It keeps documents intact and in fact adds much more information about them than Python’s base string methods have. In this sense, we might say that <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> is additive in nature, whereas text mining methods are subtractive, or reductive.</p>
<div class="section" id="document-annotations">
<h3><span class="section-number">2.2.1. </span>Document Annotations<a class="headerlink" href="#document-annotations" title="Permalink to this headline">¶</a></h3>
<p>So, while the base representation of <code class="docutils literal notranslate"><span class="pre">carafe</span></code> looks like a string, under the surface there are all sorts of annotations about it. To access them, we use the attributes counted above. For example, <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> adds extra segmentation information about a document, like which parts of it belong to different sentences. We can check to see whether this information has been attached to our text with the <code class="docutils literal notranslate"><span class="pre">.has_annotation()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="o">.</span><span class="n">has_annotation</span><span class="p">(</span><span class="s1">&#39;SENT_START&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>We can use the same method to check for a few other annotations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annotation_types</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Dependencies&#39;</span><span class="p">:</span> <span class="s1">&#39;DEP&#39;</span><span class="p">,</span> <span class="s1">&#39;Entities&#39;</span><span class="p">:</span> <span class="s1">&#39;ENT_IOB&#39;</span><span class="p">,</span> <span class="s1">&#39;Tags&#39;</span><span class="p">:</span> <span class="s1">&#39;TAG&#39;</span><span class="p">}</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">annotation_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">:</span><span class="s2">&gt;12</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">carafe</span><span class="o">.</span><span class="n">has_annotation</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dependencies: True
    Entities: True
        Tags: True
</pre></div>
</div>
</div>
</div>
<p>Let’s look at sentences. We can access them with <code class="docutils literal notranslate"><span class="pre">.sents</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="o">.</span><span class="n">sents</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;generator at 0x1268ea728&gt;
</pre></div>
</div>
</div>
</div>
<p>…but you can see that there’s a small complication here: <code class="docutils literal notranslate"><span class="pre">.sents</span></code> returns a generator, not a list. The reason has to do with memory efficiency. Because <code class="docutils literal notranslate"><span class="pre">SpaCy</span></code> adds so much extra information about your document, this information could slow down your code or overwhelm your computer if the library didn’t store it in an efficient manner. Of course this isn’t a problem with our small poem, but you can imagine how it could become one with a big corpus.</p>
<p>To access the actual sentences in <code class="docutils literal notranslate"><span class="pre">carafe</span></code>, we’ll need to convert the generator to a list.</p>
<div class="margin sidebar">
<p class="sidebar-title">Want to learn more about generators?</p>
<p>The DataLab has a workshop about them. See <a class="reference external" href="https://datalab.ucdavis.edu/eventscalendar/intermediate-python-iterator-generator-crash-course/">this link</a>.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">textwrap</span>

<span class="n">sentences</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">carafe</span><span class="o">.</span><span class="n">sents</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">shorten</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A kind in glass and a cousin, a spectacle and nothing strange a single hurt color and an [...]
All this and not ordinary, not unordered in not resembling.
The difference is spreading.
</pre></div>
</div>
</div>
</div>
<p>One very useful attribute is <code class="docutils literal notranslate"><span class="pre">.noun_chunks</span></code>. It returns nouns and compound nouns in a document.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noun_chunks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">carafe</span><span class="o">.</span><span class="n">noun_chunks</span><span class="p">)</span>

<span class="k">for</span> <span class="n">noun</span> <span class="ow">in</span> <span class="n">noun_chunks</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">noun</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A kind
glass
a cousin
a spectacle
nothing
a single hurt color
an arrangement
a system
The difference
</pre></div>
</div>
</div>
</div>
<p>See how this picks up not only nouns, but articles and compound information? Articles could be helpful if you wanted to track singular/plural relationships, while compound nouns might tell you something about the way a document refers to the entities therein. The latter could have repeating patterns, and you might imagine how you could use noun chunks to create and count n-gram tokens and feed that into a classifier.</p>
<p>Consider this example from <em>The Odyssey</em>. Homer used many epithets and repeating phrases throughout his epic. According to some theories, these act as mnemonic devices, helping a performer keep everything in their head during an oral performance (the poem wasn’t written down in Homer’s day). Using <code class="docutils literal notranslate"><span class="pre">.noun_chunks</span></code> in conjunction with a Python <code class="docutils literal notranslate"><span class="pre">Counter</span></code>, we may be able to identify these in Homer’s text. Below, we’ll do so with <em>The Odyssey</em> Book XI.</p>
<p>First, let’s load and model the text.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/session_one/odyssey_book_11.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">book_eleven</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    
<span class="n">odyssey</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">book_eleven</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we’ll import a <code class="docutils literal notranslate"><span class="pre">Counter</span></code> and initialize it. Then we’ll get the noun chunks from the document and populate them in the count dictionary with a list comprehension line. Be sure to only grab the text from each token. We’ll explain why in a little while.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">noun_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">odyssey</span><span class="o">.</span><span class="n">noun_chunks</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>With that done, let’s look for repeating noun chunks with three or more words.</p>
<div class="margin sidebar">
<p class="sidebar-title">What we’re doing here…</p>
<p>For every noun chunk in the counter:</p>
<ol class="simple">
<li><p>Split the chunk</p></li>
<li><p>Check if the length of the chunk is more than two and the count is more than one</p></li>
<li><p>If so, join the chunk back together and print it along with the chunk</p></li>
</ol>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">noun_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">joined</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;PHRASE&#39;</span><span class="p">:</span> <span class="n">joined</span><span class="p">,</span>
            <span class="s1">&#39;COUNT&#39;</span><span class="p">:</span> <span class="n">count</span>
        <span class="p">})</span>
        
<span class="n">chunks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;PHRASE&#39;</span><span class="p">)</span>
<span class="n">chunks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT</th>
    </tr>
    <tr>
      <th>PHRASE</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>the sea shore</th>
      <td>2</td>
    </tr>
    <tr>
      <th>a fair wind</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the poor feckless ghosts</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the same time</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the other side</th>
      <td>2</td>
    </tr>
    <tr>
      <th>his golden sceptre</th>
      <td>2</td>
    </tr>
    <tr>
      <th>your own house</th>
      <td>2</td>
    </tr>
    <tr>
      <th>her own son</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the Achaean land</th>
      <td>2</td>
    </tr>
    <tr>
      <th>her own husband</th>
      <td>2</td>
    </tr>
    <tr>
      <th>my wicked wife</th>
      <td>2</td>
    </tr>
    <tr>
      <th>all the Danaans</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the poor creature</th>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Excellent! Looks like we turned up a few: “the poor feckless ghosts,” “my wicked wife,” and “all the Danaans” are likely the kind of repeating phrases scholars think of in Homer’s text.</p>
<p>Another way to look at entities in a text is with <code class="docutils literal notranslate"><span class="pre">.ents</span></code>. <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> uses <strong>named-entity recognition</strong> to extract significant objects, or entities, in a document. In general, anything that has a proper name associated with it is considered an entity, but things expressions of time and geographic location are also often tagged. Here are the first five from Book XI above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">entities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">odyssey</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span>

<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="n">count</span><span class="p">])</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Circe
Oceanus
Cimmerians
Circe
Perimedes
</pre></div>
</div>
</div>
</div>
<p>You can select particular entities using the <code class="docutils literal notranslate"><span class="pre">.label_</span></code> attribute. Here are all the temporal entities in Book XI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">odyssey</span><span class="o">.</span><span class="n">ents</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">label_</span> <span class="o">==</span> <span class="s1">&#39;TIME&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;all night&#39;, &#39;to-morrow morning&#39;, &#39;the light of day&#39;]
</pre></div>
</div>
</div>
</div>
<p>And here is a unique listing of all the people.</p>
<div class="margin sidebar">
<p class="sidebar-title">How many labels are there?</p>
<p>This will depend on the model. Here’s the <a class="reference external" href="https://spacy.io/models/en#en_core_web_md-labels">label scheme</a> for the one we’re using.</p>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">odyssey</span><span class="o">.</span><span class="n">ents</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">label_</span> <span class="o">==</span> <span class="s1">&#39;PERSON&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Achilles&#39;,
 &#39;Aeson&#39;,
 &#39;Alcinous&#39;,
 &#39;Arete&#39;,
 &#39;Ariadne&#39;,
 &#39;Cassandra&#39;,
 &#39;Chloris&#39;,
 &#39;Circe&#39;,
 &#39;Clytemnestra&#39;,
 &#39;Diana&#39;,
 &#39;Echeneus&#39;,
 &#39;Epicaste&#39;,
 &#39;Eriphyle&#39;,
 &#39;Eurylochus&#39;,
 &#39;Helen&#39;,
 &#39;Iphicles&#39;,
 &#39;Iphimedeia&#39;,
 &#39;Jove&#39;,
 &#39;Leda&#39;,
 &#39;Leto&#39;,
 &#39;Maera&#39;,
 &#39;Megara&#39;,
 &#39;Memnon&#39;,
 &#39;Minerva&#39;,
 &#39;Neleus&#39;,
 &#39;Neoptolemus&#39;,
 &#39;Nestor&#39;,
 &#39;OEdipodes&#39;,
 &#39;Orestes&#39;,
 &#39;Ossa&#39;,
 &#39;Periclymenus&#39;,
 &#39;Perimedes&#39;,
 &#39;Pero&#39;,
 &#39;Pollux&#39;,
 &#39;Priam&#39;,
 &#39;Proserpine&#39;,
 &#39;Pylos&#39;,
 &#39;Pytho&#39;,
 &#39;Queen&#39;,
 &#39;Scyros&#39;,
 &#39;Sisyphus&#39;,
 &#39;Teiresias&#39;,
 &#39;Telemachus&#39;,
 &#39;Theban Teiresias&#39;,
 &#39;Ulysses&#39;}
</pre></div>
</div>
</div>
</div>
<p>Don’t see an entity that you know to be in your document? You can add more to the <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> model. Doing so is beyond the scope of our workshop session, but the library’s <code class="docutils literal notranslate"><span class="pre">EntityRuler()</span></code> <a class="reference external" href="https://spacy.io/api/entityruler">documentation</a> will show you how.</p>
</div>
<div class="section" id="token-annotations">
<h3><span class="section-number">2.2.2. </span>Token Annotations<a class="headerlink" href="#token-annotations" title="Permalink to this headline">¶</a></h3>
<p>In addition to storing all of this information about texts, <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> creates a substantial amount of annotations for each of the tokens in that document. The same logic as above applies to accessing this information.</p>
<p>Let’s return to the Stein poem. Indexing <code class="docutils literal notranslate"><span class="pre">carafe</span></code> will return individual tokens:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>glass
</pre></div>
</div>
</div>
</div>
<p>Like <code class="docutils literal notranslate"><span class="pre">carafe</span></code>, each one has several attributes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">token_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of token attributes:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">token_attributes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of token attributes: 94
</pre></div>
</div>
</div>
</div>
<p>That’s a lot!</p>
<p>These attributes range from simple booleans, like whether a token is an alphabetic character:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">is_alpha</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>…or whether it is a stop word:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">is_stop</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>…to more complex pieces of information, like tracking back to the sentence this token is part of:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">sent</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A kind in glass and a cousin, a spectacle and nothing strange a single hurt color and an arrangement in a system to pointing.
</pre></div>
</div>
</div>
</div>
<p>…sentiment scores:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">sentiment</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>…and even vector space representations:</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-1.4859e-01, -1.7940e-01,  4.3666e-02,  1.5748e-01,  1.3568e-01,
       -9.3666e-01, -6.8430e-01,  4.7692e-01, -4.1391e-01,  9.3575e-01,
       -1.6360e-01,  6.7553e-02, -2.7843e-01, -5.6125e-01,  1.3088e-01,
       -1.0006e-01,  7.0374e-03,  2.6217e+00,  5.4600e-02, -5.8931e-01,
        2.5739e-04, -2.6791e-01,  4.6093e-01, -5.9145e-02, -1.0330e-01,
       -3.7589e-01, -2.5343e-01,  1.4790e-02, -4.8031e-01, -4.4314e-01,
        2.4685e-01, -8.6519e-04, -1.2361e-01,  9.1683e-02, -1.5880e-01,
       -4.5974e-01,  3.3017e-01, -4.4124e-01,  3.3604e-01, -3.0438e-01,
        4.4664e-01,  2.2697e-01,  2.9327e-02, -2.7025e-01,  3.1813e-01,
       -1.5890e-01, -4.1371e-01, -9.0721e-01, -2.0866e-01,  3.6400e-01,
        5.6862e-02, -2.6824e-01, -2.9722e-01,  6.2107e-02, -4.7908e-01,
       -5.8164e-01, -1.4302e-01,  7.0109e-02, -1.2735e-01,  3.6194e-02,
       -1.6634e-01, -2.2135e-01, -5.0446e-02,  4.3839e-01, -5.5363e-01,
       -4.4219e-01, -1.3657e-01, -2.8472e-01, -5.0637e-01,  7.9913e-01,
        3.8253e-02, -2.9499e-01,  4.3688e-01,  8.3770e-02, -1.4432e-01,
        6.6395e-01, -2.1807e-01,  5.4256e-02, -3.6963e-01,  3.3715e-02,
       -2.0889e-01,  3.8404e-01, -3.3217e-02,  6.1296e-05, -8.7465e-01,
       -4.6473e-01,  9.2310e-01,  1.8017e+00, -6.3421e-01, -7.6744e-02,
        1.8829e-01, -7.6714e-02,  5.7521e-01,  4.8993e-01,  4.5188e-01,
       -3.1280e-01,  3.0696e-01, -1.8402e-01, -8.0179e-02,  1.0587e-01,
        6.2712e-01,  2.5180e-02,  1.3250e-02,  2.0200e-01, -4.9301e-01,
       -7.0543e-01,  1.7630e-01, -3.8573e-01,  1.4884e-01,  1.1469e-01,
       -2.4512e-01,  4.0795e-01,  4.0503e-01, -7.7637e-01,  2.9981e-01,
        8.6308e-02, -3.4265e-01, -1.0283e-01,  6.5428e-01,  1.0040e+00,
        7.9215e-02,  1.4525e-01,  2.6923e-01,  3.0525e-01,  2.4649e-01,
       -4.8161e-01,  3.2354e-01, -4.3063e-01,  1.3162e-01,  3.0885e-01,
        2.8071e-02,  2.0262e-01,  5.5863e-02,  1.2160e-01,  9.4541e-02,
        3.6149e-01, -2.4719e-01,  4.8192e-01,  1.7732e-02, -2.5866e-01,
       -2.0020e+00,  3.9600e-01,  2.7223e-01,  2.7166e-01, -2.8302e-01,
       -3.3678e-01, -5.5586e-01,  1.2634e-01,  6.2432e-01, -3.5482e-01,
        1.2412e-01,  2.3334e-01,  1.4205e-01,  1.8260e-01, -2.7955e-01,
       -2.7223e-01,  2.6309e-01,  1.9212e-01,  2.0547e-02,  4.1270e-01,
       -9.5296e-02, -2.0779e-01, -4.3821e-01,  6.5274e-01,  5.6938e-01,
       -3.7614e-01,  2.0610e-02, -2.3933e-01, -4.5018e-02,  7.8979e-01,
       -5.6471e-02, -6.9630e-01, -3.7204e-01,  4.7623e-01, -4.0311e-01,
       -2.2279e-01,  2.9097e-01, -3.1518e-02,  1.8166e-01, -1.2901e+00,
        1.7859e-02,  1.4502e-01,  2.5328e-01,  1.4368e-01, -2.8549e-01,
       -2.8093e-01,  3.4198e-01,  4.3326e-01, -1.8720e-01, -2.0026e-02,
       -5.1639e-01, -1.8429e-01,  2.6677e-01, -5.4715e-01,  1.3708e-01,
        8.5359e-01, -3.3253e-02,  6.5259e-02,  6.3762e-03, -2.0237e-01,
       -2.0636e-01,  2.5313e-01,  2.4637e-01, -1.5723e-01,  1.2737e-01,
       -1.3642e-01, -5.0911e-02,  8.9525e-02, -1.7082e-02, -1.1004e-02,
       -3.0895e-01,  1.2306e-02,  2.2061e-01, -7.4971e-01,  5.6255e-01,
        1.8285e-01,  1.0815e-01, -3.0618e-01, -2.2243e-01, -2.0343e-01,
       -3.2494e-01, -5.1475e-02,  2.5458e-01,  4.1998e-01,  2.2291e-01,
        2.6603e-01, -5.2339e-01, -2.4402e-01, -3.4416e-01,  1.7581e-01,
       -1.6235e-01,  1.0313e-01, -7.9232e-02,  4.2340e-02, -2.1850e-01,
        5.7816e-02,  5.7152e-01,  3.3476e-01,  4.1512e-01, -2.9936e-01,
        6.5527e-01,  8.0372e-01,  7.6235e-02, -2.4887e-02,  3.0213e-01,
        3.9550e-01,  6.1762e-02,  2.9353e-02, -3.6386e-01, -3.3995e-02,
        4.1919e-01, -1.9895e-01, -1.2398e-02, -2.9315e-01,  2.4226e-01,
        3.4726e-01,  3.7107e-03, -2.3358e-01,  5.1316e-02,  1.9872e-01,
        4.9645e-01,  6.8326e-01,  1.9632e-01,  1.3301e-01,  1.4365e-01,
        2.1953e-01, -3.8584e-01,  7.6862e-02, -3.8999e-01, -3.7050e-01,
       -4.5012e-01,  2.6216e-02,  3.0185e-01, -4.0049e-01,  3.3771e-01,
        7.1870e-02, -1.3996e-01,  1.5457e-01,  2.2269e-01, -1.5383e-02,
        5.0255e-02,  1.2920e-01,  8.6803e-02,  1.0577e-01, -1.1371e-01,
       -2.5309e-01,  5.2190e-01,  2.1234e-01, -3.2938e-02,  4.0497e-01,
       -5.4544e-01,  1.2056e-01,  2.9463e-01,  1.4404e-01, -2.9775e-01,
        4.5954e-01, -2.8968e-01,  2.5130e-01,  2.2969e-01,  4.5593e-01],
      dtype=float32)
</pre></div>
</div>
</div>
</div>
<p>Here’s a listing of some attributes you might want to know about when text mining.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_attributes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span><span class="p">:</span>
    <span class="n">sample_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;INDEX&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
        <span class="s1">&#39;TEXT&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s1">&#39;LOWERCASE&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">lower_</span><span class="p">,</span>
        <span class="s1">&#39;ALPHABETIC&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">is_alpha</span><span class="p">,</span>
        <span class="s1">&#39;DIGIT&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">is_digit</span><span class="p">,</span>
        <span class="s1">&#39;PUNCTUATION&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">is_punct</span><span class="p">,</span>
        <span class="s1">&#39;STARTS SENTENCE&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">is_sent_start</span><span class="p">,</span>
        <span class="s1">&#39;LIKE URL&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">like_url</span>
    <span class="p">})</span>

<span class="n">sample_attributes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sample_attributes</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;INDEX&#39;</span><span class="p">)</span>
<span class="n">sample_attributes</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TEXT</th>
      <th>LOWERCASE</th>
      <th>ALPHABETIC</th>
      <th>DIGIT</th>
      <th>PUNCTUATION</th>
      <th>STARTS SENTENCE</th>
      <th>LIKE URL</th>
    </tr>
    <tr>
      <th>INDEX</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>a</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>kind</td>
      <td>kind</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>in</td>
      <td>in</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>glass</td>
      <td>glass</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>and</td>
      <td>and</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>a</td>
      <td>a</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>6</th>
      <td>cousin</td>
      <td>cousin</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>7</th>
      <td>,</td>
      <td>,</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>8</th>
      <td>a</td>
      <td>a</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>9</th>
      <td>spectacle</td>
      <td>spectacle</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We’ll discuss some of the more complex annotations later on, both in this session and others. For now, let’s collect some simple information about each of the tokens in our document. We’ll use list comprehension to do so. We’ll also use the <code class="docutils literal notranslate"><span class="pre">.text</span></code> attribute for each token, since we only want the text representation. Otherwise, we’d be creating a list of generators, where each generator has all those attribute for every token! (This is why we made sure to only use <code class="docutils literal notranslate"><span class="pre">.text</span></code> in our work with <em>The Odyssey</em> above.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_alpha</span><span class="p">])</span>
<span class="n">punctuation</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_punct</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Words</span><span class="se">\n</span><span class="s2">-----</span><span class="se">\n</span><span class="si">{</span><span class="n">textwrap</span><span class="o">.</span><span class="n">shorten</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Punctuation</span><span class="se">\n</span><span class="s2">-----------</span><span class="se">\n</span><span class="si">{</span><span class="n">punctuation</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Words
-----
A kind in glass and a cousin a spectacle and nothing strange a single hurt color and an [...] 

Punctuation
-----------
, . , . .
</pre></div>
</div>
</div>
</div>
<p>Want some linguistic information? We can get that too. For example, here are prefixes and suffixes:</p>
<div class="margin sidebar">
<p class="sidebar-title">You might be wondering about those underscores…</p>
<p>The syntax conventions of <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> use an underscore to access the actual attribute information for a token. Using an attribute without the underscore will return an id, which the library uses internally to piece together output.</p>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prefix_suffix</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_alpha</span><span class="p">:</span>
        <span class="n">prefix_suffix</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;PREFIX&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">prefix_</span><span class="p">,</span>
            <span class="s1">&#39;SUFFIX&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">suffix_</span>
        <span class="p">})</span>

<span class="n">prefix_suffix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prefix_suffix</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">prefix_suffix</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PREFIX</th>
      <th>SUFFIX</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>A</td>
      <td>A</td>
    </tr>
    <tr>
      <th>kind</th>
      <td>k</td>
      <td>ind</td>
    </tr>
    <tr>
      <th>in</th>
      <td>i</td>
      <td>in</td>
    </tr>
    <tr>
      <th>glass</th>
      <td>g</td>
      <td>ass</td>
    </tr>
    <tr>
      <th>and</th>
      <td>a</td>
      <td>and</td>
    </tr>
    <tr>
      <th>a</th>
      <td>a</td>
      <td>a</td>
    </tr>
    <tr>
      <th>cousin</th>
      <td>c</td>
      <td>sin</td>
    </tr>
    <tr>
      <th>a</th>
      <td>a</td>
      <td>a</td>
    </tr>
    <tr>
      <th>spectacle</th>
      <td>s</td>
      <td>cle</td>
    </tr>
    <tr>
      <th>and</th>
      <td>a</td>
      <td>and</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And here are lemmas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lemmas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_alpha</span><span class="p">:</span>
        <span class="n">lemmas</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;LEMMA&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">lemma_</span>
        <span class="p">})</span>

<span class="n">lemmas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">lemmas</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">lemmas</span><span class="p">[</span><span class="mi">24</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LEMMA</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>All</th>
      <td>all</td>
    </tr>
    <tr>
      <th>this</th>
      <td>this</td>
    </tr>
    <tr>
      <th>and</th>
      <td>and</td>
    </tr>
    <tr>
      <th>not</th>
      <td>not</td>
    </tr>
    <tr>
      <th>ordinary</th>
      <td>ordinary</td>
    </tr>
    <tr>
      <th>not</th>
      <td>not</td>
    </tr>
    <tr>
      <th>unordered</th>
      <td>unordere</td>
    </tr>
    <tr>
      <th>in</th>
      <td>in</td>
    </tr>
    <tr>
      <th>not</th>
      <td>not</td>
    </tr>
    <tr>
      <th>resembling</th>
      <td>resemble</td>
    </tr>
    <tr>
      <th>The</th>
      <td>the</td>
    </tr>
    <tr>
      <th>difference</th>
      <td>difference</td>
    </tr>
    <tr>
      <th>is</th>
      <td>be</td>
    </tr>
    <tr>
      <th>spreading</th>
      <td>spread</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>With such attributes at your disposal, you might imagine how you could work <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> into a text mining pipeline. Instead of using separate functions to clean your corpus, those steps could all be accomplished by accessing attributes.</p>
<p>Before you do this, however, you should consider two things: 1) whether the increased computational/memory overhead is worthwhile for your project; and 2) whether <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>’s base models will work for the kind of text you’re using. This second point is especially important. While <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>’s base models are incredibly powerful, they are built for general purpose applications and may struggle with domain-specific language. Medical text and early modern print are two such examples of where the base models interpret your documents in unexpected ways, thereby complicating, maybe even ruining, parts of a text mining pipeline that relies on them. Sometimes, in other words, it’s just best to stick with a text mining pipeline that you know to be effective.</p>
<p>That all said, there are ways to train your own <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> model on a specific domain. This can be an extensive process, one which exceeds the limits of our short workshop, but if you want to learn more about doing so, you can visit <a class="reference external" href="https://spacy.io/usage/training">this page</a>. There are also <a class="reference external" href="https://spacy.io/universe/category/models">third party models</a> available, which you might find useful, though your milage may vary.</p>
</div>
</div>
<div class="section" id="part-of-speech-tagging">
<h2><span class="section-number">2.3. </span>Part-of-Speech Tagging<a class="headerlink" href="#part-of-speech-tagging" title="Permalink to this headline">¶</a></h2>
<p>One of the most common tasks in NLP involves assigning <strong>part-of-speech, or POS, tags</strong> to each token in a document. As we saw in the text mining series, these tags are a necessary step for certain text cleaning process, like lemmatization; you might also use them to identify subsets of your data, which you could separate out and model. Beyond text cleaning, POS tags can be useful for tasks like <strong>word sense disambiguation</strong>, where you try to determine which particular facet of meaning a given token represents.</p>
<p>Regardless of the task, the process of getting POS tags from <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> will be the same. Each token in a document has an associated tag, which is accessible as an attribute.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pos</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span><span class="p">:</span>
    <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s1">&#39;POS_TAG&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">pos_</span>
    <span class="p">})</span>

<span class="n">pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">pos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>POS_TAG</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>kind</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>in</th>
      <td>ADP</td>
    </tr>
    <tr>
      <th>glass</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CCONJ</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>cousin</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>,</th>
      <td>PUNCT</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>spectacle</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CCONJ</td>
    </tr>
    <tr>
      <th>nothing</th>
      <td>PRON</td>
    </tr>
    <tr>
      <th>strange</th>
      <td>ADJ</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>single</th>
      <td>ADJ</td>
    </tr>
    <tr>
      <th>hurt</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>color</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CCONJ</td>
    </tr>
    <tr>
      <th>an</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>arrangement</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>in</th>
      <td>ADP</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>system</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>to</th>
      <td>ADP</td>
    </tr>
    <tr>
      <th>pointing</th>
      <td>VERB</td>
    </tr>
    <tr>
      <th>.</th>
      <td>PUNCT</td>
    </tr>
    <tr>
      <th>All</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>this</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CCONJ</td>
    </tr>
    <tr>
      <th>not</th>
      <td>PART</td>
    </tr>
    <tr>
      <th>ordinary</th>
      <td>ADJ</td>
    </tr>
    <tr>
      <th>,</th>
      <td>PUNCT</td>
    </tr>
    <tr>
      <th>not</th>
      <td>PART</td>
    </tr>
    <tr>
      <th>unordered</th>
      <td>VERB</td>
    </tr>
    <tr>
      <th>in</th>
      <td>ADP</td>
    </tr>
    <tr>
      <th>not</th>
      <td>PART</td>
    </tr>
    <tr>
      <th>resembling</th>
      <td>VERB</td>
    </tr>
    <tr>
      <th>.</th>
      <td>PUNCT</td>
    </tr>
    <tr>
      <th>The</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>difference</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>is</th>
      <td>AUX</td>
    </tr>
    <tr>
      <th>spreading</th>
      <td>VERB</td>
    </tr>
    <tr>
      <th>.</th>
      <td>PUNCT</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If you don’t know what a tag means, you can use <code class="docutils literal notranslate"><span class="pre">spacy.explain()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="s1">&#39;CCONJ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;coordinating conjunction&#39;
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">spaCy</span></code> actually has two types of POS tags. The ones accessible with the <code class="docutils literal notranslate"><span class="pre">.pos_</span></code> attribute are the basic tags, whereas those under <code class="docutils literal notranslate"><span class="pre">.tag_</span></code> are more detailed (these come from the <a class="reference external" href="https://www.ling.upenn.edu/courses/Fall_2003/ling001/penn_treebank_pos.html">Penn Treebank project</a>). We’ll print them out below, along with information about what they mean.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">detailed_tags</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span><span class="p">:</span>
    <span class="n">detailed_tags</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s1">&#39;POS_TAG&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="p">,</span>
        <span class="s1">&#39;EXPLANATION&#39;</span><span class="p">:</span> <span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="p">)</span>
    <span class="p">})</span>

<span class="n">detailed_tags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">detailed_tags</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">detailed_tags</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>POS_TAG</th>
      <th>EXPLANATION</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>kind</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>in</th>
      <td>IN</td>
      <td>conjunction, subordinating or preposition</td>
    </tr>
    <tr>
      <th>glass</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CC</td>
      <td>conjunction, coordinating</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>cousin</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>,</th>
      <td>,</td>
      <td>punctuation mark, comma</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>spectacle</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CC</td>
      <td>conjunction, coordinating</td>
    </tr>
    <tr>
      <th>nothing</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>strange</th>
      <td>JJ</td>
      <td>adjective (English), other noun-modifier (Chin...</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>single</th>
      <td>JJ</td>
      <td>adjective (English), other noun-modifier (Chin...</td>
    </tr>
    <tr>
      <th>hurt</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>color</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CC</td>
      <td>conjunction, coordinating</td>
    </tr>
    <tr>
      <th>an</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>arrangement</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>in</th>
      <td>IN</td>
      <td>conjunction, subordinating or preposition</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>system</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>to</th>
      <td>IN</td>
      <td>conjunction, subordinating or preposition</td>
    </tr>
    <tr>
      <th>pointing</th>
      <td>VBG</td>
      <td>verb, gerund or present participle</td>
    </tr>
    <tr>
      <th>.</th>
      <td>.</td>
      <td>punctuation mark, sentence closer</td>
    </tr>
    <tr>
      <th>All</th>
      <td>PDT</td>
      <td>predeterminer</td>
    </tr>
    <tr>
      <th>this</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CC</td>
      <td>conjunction, coordinating</td>
    </tr>
    <tr>
      <th>not</th>
      <td>RB</td>
      <td>adverb</td>
    </tr>
    <tr>
      <th>ordinary</th>
      <td>JJ</td>
      <td>adjective (English), other noun-modifier (Chin...</td>
    </tr>
    <tr>
      <th>,</th>
      <td>,</td>
      <td>punctuation mark, comma</td>
    </tr>
    <tr>
      <th>not</th>
      <td>RB</td>
      <td>adverb</td>
    </tr>
    <tr>
      <th>unordered</th>
      <td>VBN</td>
      <td>verb, past participle</td>
    </tr>
    <tr>
      <th>in</th>
      <td>IN</td>
      <td>conjunction, subordinating or preposition</td>
    </tr>
    <tr>
      <th>not</th>
      <td>RB</td>
      <td>adverb</td>
    </tr>
    <tr>
      <th>resembling</th>
      <td>VBG</td>
      <td>verb, gerund or present participle</td>
    </tr>
    <tr>
      <th>.</th>
      <td>.</td>
      <td>punctuation mark, sentence closer</td>
    </tr>
    <tr>
      <th>The</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>difference</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>is</th>
      <td>VBZ</td>
      <td>verb, 3rd person singular present</td>
    </tr>
    <tr>
      <th>spreading</th>
      <td>VBG</td>
      <td>verb, gerund or present participle</td>
    </tr>
    <tr>
      <th>.</th>
      <td>.</td>
      <td>punctuation mark, sentence closer</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>This is all well and good in the abstract, but the power of POS tags lies in how they support other kinds of analysis. We’ll do a quick word sense disambiguation task here but will return to do something more complex in a little while.</p>
<p>Between the two strings:</p>
<ol class="simple">
<li><p>“I am not going to bank on that happening.”</p></li>
<li><p>“I went down to the river bank.”</p></li>
</ol>
<p>How can we tell which sense of the word “bank” is being used? Well, we can model each with <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> and see whether the POS tags for these two tokens match. If they don’t match, this will indicate that the tokens represent two different senses of the word “bank.”</p>
<p>All this can be accomplished with a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop and <code class="docutils literal notranslate"><span class="pre">nlp.pipe()</span></code>. The latter function enables you to process different documents with the <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> model all at once. This can be great for working with a large corpus, though note that, because <code class="docutils literal notranslate"><span class="pre">.pipe()</span></code> is meant to work on text at scale, it will return a generator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;I am not going to bank on that happening.&quot;</span><span class="p">,</span> <span class="s2">&quot;I went down to the river bank.&quot;</span><span class="p">]</span>

<span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">banks</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;generator object Language.pipe at 0x12ed8b1b0&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">banks</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;bank&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">+ </span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>I am not going to bank on that happening.
+ bank: VB (verb, base form)

I went down to the river bank.
+ bank: NN (noun, singular or mass)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dependency-parsing">
<h2><span class="section-number">2.4. </span>Dependency Parsing<a class="headerlink" href="#dependency-parsing" title="Permalink to this headline">¶</a></h2>
<p>TODO: a discussion of dependency parsing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spacy</span> <span class="kn">import</span> <span class="n">displacy</span>

<span class="n">to_render</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">carafe</span><span class="o">.</span><span class="n">sents</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">displacy</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">to_render</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;dep&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span class="tex2jax_ignore"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:lang="en" id="11a624cdc06142b98812ff090caecb33-0" class="displacy" width="750" height="312.0" direction="ltr" style="max-width: none; height: 312.0px; color: #000000; background: #ffffff; font-family: Arial; direction: ltr">
<text class="displacy-token" fill="currentColor" text-anchor="middle" y="222.0">
    <tspan class="displacy-word" fill="currentColor" x="50">The</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="50">DET</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="222.0">
    <tspan class="displacy-word" fill="currentColor" x="225">difference</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="225">NOUN</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="222.0">
    <tspan class="displacy-word" fill="currentColor" x="400">is</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="400">AUX</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="222.0">
    <tspan class="displacy-word" fill="currentColor" x="575">spreading.</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="575">VERB</tspan>
</text>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-11a624cdc06142b98812ff090caecb33-0-0" stroke-width="2px" d="M70,177.0 C70,89.5 220.0,89.5 220.0,177.0" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px">
        <textPath xlink:href="#arrow-11a624cdc06142b98812ff090caecb33-0-0" class="displacy-label" startOffset="50%" side="left" fill="currentColor" text-anchor="middle">det</textPath>
    </text>
    <path class="displacy-arrowhead" d="M70,179.0 L62,167.0 78,167.0" fill="currentColor"/>
</g>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-11a624cdc06142b98812ff090caecb33-0-1" stroke-width="2px" d="M245,177.0 C245,2.0 575.0,2.0 575.0,177.0" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px">
        <textPath xlink:href="#arrow-11a624cdc06142b98812ff090caecb33-0-1" class="displacy-label" startOffset="50%" side="left" fill="currentColor" text-anchor="middle">nsubj</textPath>
    </text>
    <path class="displacy-arrowhead" d="M245,179.0 L237,167.0 253,167.0" fill="currentColor"/>
</g>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-11a624cdc06142b98812ff090caecb33-0-2" stroke-width="2px" d="M420,177.0 C420,89.5 570.0,89.5 570.0,177.0" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px">
        <textPath xlink:href="#arrow-11a624cdc06142b98812ff090caecb33-0-2" class="displacy-label" startOffset="50%" side="left" fill="currentColor" text-anchor="middle">aux</textPath>
    </text>
    <path class="displacy-arrowhead" d="M420,179.0 L412,167.0 428,167.0" fill="currentColor"/>
</g>
</svg></span></div></div>
</div>
<p>Seeing these relationships are quite useful in and of themselves, but the real power of dependency parsing comes in all the extra data it can provide about a token. Using this technique, you can link tokens back to their heads, or find local groupings of tokens that all refer to the same head.</p>
<p>Here’s how you could formalize that with a dataframe. Given this sentence:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sentence</span> <span class="o">=</span> <span class="n">odyssey</span><span class="p">[</span><span class="mi">2246</span><span class="p">:</span><span class="mi">2260</span><span class="p">]</span>
<span class="n">sentence</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;Then I tried to find some way of embracing my mother&#39;s ghost.&quot;
</pre></div>
</div>
</div>
</div>
<p>We can construct a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop, which rolls through each token and retrieves its dependency info.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">:</span>
    <span class="n">dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;INDEX&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
        <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s1">&#39;DEPENDENCY_SHORTCODE&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">dep_</span><span class="p">,</span>
        <span class="s1">&#39;DEPENDENCY&#39;</span><span class="p">:</span> <span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">dep_</span><span class="p">),</span>
        <span class="s1">&#39;HEAD_INDEX&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
        <span class="s1">&#39;HEAD&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">head</span>
    <span class="p">})</span>
    
<span class="n">dependencies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dependencies</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;INDEX&#39;</span><span class="p">)</span>
<span class="n">dependencies</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TOKEN</th>
      <th>DEPENDENCY_SHORTCODE</th>
      <th>DEPENDENCY</th>
      <th>HEAD_INDEX</th>
      <th>HEAD</th>
    </tr>
    <tr>
      <th>INDEX</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2246</th>
      <td>Then</td>
      <td>advmod</td>
      <td>adverbial modifier</td>
      <td>2248</td>
      <td>tried</td>
    </tr>
    <tr>
      <th>2247</th>
      <td>I</td>
      <td>nsubj</td>
      <td>nominal subject</td>
      <td>2248</td>
      <td>tried</td>
    </tr>
    <tr>
      <th>2248</th>
      <td>tried</td>
      <td>ROOT</td>
      <td>None</td>
      <td>2248</td>
      <td>tried</td>
    </tr>
    <tr>
      <th>2249</th>
      <td>to</td>
      <td>aux</td>
      <td>auxiliary</td>
      <td>2250</td>
      <td>find</td>
    </tr>
    <tr>
      <th>2250</th>
      <td>find</td>
      <td>xcomp</td>
      <td>open clausal complement</td>
      <td>2248</td>
      <td>tried</td>
    </tr>
    <tr>
      <th>2251</th>
      <td>some</td>
      <td>det</td>
      <td>determiner</td>
      <td>2252</td>
      <td>way</td>
    </tr>
    <tr>
      <th>2252</th>
      <td>way</td>
      <td>dobj</td>
      <td>direct object</td>
      <td>2250</td>
      <td>find</td>
    </tr>
    <tr>
      <th>2253</th>
      <td>of</td>
      <td>prep</td>
      <td>prepositional modifier</td>
      <td>2252</td>
      <td>way</td>
    </tr>
    <tr>
      <th>2254</th>
      <td>embracing</td>
      <td>pcomp</td>
      <td>complement of preposition</td>
      <td>2253</td>
      <td>of</td>
    </tr>
    <tr>
      <th>2255</th>
      <td>my</td>
      <td>poss</td>
      <td>possession modifier</td>
      <td>2256</td>
      <td>mother</td>
    </tr>
    <tr>
      <th>2256</th>
      <td>mother</td>
      <td>poss</td>
      <td>possession modifier</td>
      <td>2258</td>
      <td>ghost</td>
    </tr>
    <tr>
      <th>2257</th>
      <td>'s</td>
      <td>case</td>
      <td>case marking</td>
      <td>2256</td>
      <td>mother</td>
    </tr>
    <tr>
      <th>2258</th>
      <td>ghost</td>
      <td>dobj</td>
      <td>direct object</td>
      <td>2254</td>
      <td>embracing</td>
    </tr>
    <tr>
      <th>2259</th>
      <td>.</td>
      <td>punct</td>
      <td>punctuation</td>
      <td>2248</td>
      <td>tried</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How many tokens are associated with each head?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;HEAD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HEAD
tried        5
find         2
way          2
of           1
embracing    1
mother       2
ghost        1
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Which tokens are in each of these groups?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;HEAD&#39;</span><span class="p">):</span>
    <span class="n">head</span><span class="p">,</span> <span class="n">tokens</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">group</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;HEAD&#39;</span><span class="p">:</span> <span class="n">head</span><span class="p">,</span>
        <span class="s1">&#39;GROUP&#39;</span><span class="p">:</span> <span class="n">tokens</span>
    <span class="p">})</span>
    
<span class="n">groups</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;HEAD&#39;</span><span class="p">)</span>
<span class="n">groups</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GROUP</th>
    </tr>
    <tr>
      <th>HEAD</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>tried</th>
      <td>[Then, I, tried, find, .]</td>
    </tr>
    <tr>
      <th>find</th>
      <td>[to, way]</td>
    </tr>
    <tr>
      <th>way</th>
      <td>[some, of]</td>
    </tr>
    <tr>
      <th>of</th>
      <td>[embracing]</td>
    </tr>
    <tr>
      <th>embracing</th>
      <td>[ghost]</td>
    </tr>
    <tr>
      <th>mother</th>
      <td>[my, 's]</td>
    </tr>
    <tr>
      <th>ghost</th>
      <td>[mother]</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sciPy</span></code> also has a special <code class="docutils literal notranslate"><span class="pre">.subtree</span></code> attribute for each token, which will also produce a similar set of local groupings. Note however that <code class="docutils literal notranslate"><span class="pre">.subtree</span></code> captures all tokens that hold a dependent relationship with the one in question, meaning that when you find the subtree of the root, you’re going to print out the entire sentence.</p>
<p>As you might expect by now, <code class="docutils literal notranslate"><span class="pre">.subtree</span></code> returns a generator, so convert it to a list or use list comprehension to extract the tokens. We’ll do this in a separate function. Within this function, we’re going to use the <code class="docutils literal notranslate"><span class="pre">.text_with_ws</span></code> attribute of each token in the subtree to return an exact, string-like representation of the tree (this will include any whitespace characters that are attached to a token).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">subtree_to_text</span><span class="p">(</span><span class="n">subtree</span><span class="p">):</span>
    <span class="n">subtree</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">text_with_ws</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">subtree</span><span class="p">])</span>
    <span class="n">subtree</span> <span class="o">=</span> <span class="n">subtree</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">subtree</span>

<span class="n">sentence_trees</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">:</span>
    <span class="n">subtree</span> <span class="o">=</span> <span class="n">subtree_to_text</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">subtree</span><span class="p">)</span>
    <span class="n">sentence_trees</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s1">&#39;DEPENDENCY&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">dep_</span><span class="p">,</span>
        <span class="s1">&#39;SUBTREE&#39;</span><span class="p">:</span> <span class="n">subtree</span>
    <span class="p">})</span>

<span class="n">sentence_trees</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sentence_trees</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">sentence_trees</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DEPENDENCY</th>
      <th>SUBTREE</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Then</th>
      <td>advmod</td>
      <td>Then</td>
    </tr>
    <tr>
      <th>I</th>
      <td>nsubj</td>
      <td>I</td>
    </tr>
    <tr>
      <th>tried</th>
      <td>ROOT</td>
      <td>"Then I tried to find some way of embracing my...</td>
    </tr>
    <tr>
      <th>to</th>
      <td>aux</td>
      <td>to</td>
    </tr>
    <tr>
      <th>find</th>
      <td>xcomp</td>
      <td>to find some way of embracing my mother's ghost</td>
    </tr>
    <tr>
      <th>some</th>
      <td>det</td>
      <td>some</td>
    </tr>
    <tr>
      <th>way</th>
      <td>dobj</td>
      <td>some way of embracing my mother's ghost</td>
    </tr>
    <tr>
      <th>of</th>
      <td>prep</td>
      <td>of embracing my mother's ghost</td>
    </tr>
    <tr>
      <th>embracing</th>
      <td>pcomp</td>
      <td>embracing my mother's ghost</td>
    </tr>
    <tr>
      <th>my</th>
      <td>poss</td>
      <td>my</td>
    </tr>
    <tr>
      <th>mother</th>
      <td>poss</td>
      <td>my mother's</td>
    </tr>
    <tr>
      <th>'s</th>
      <td>case</td>
      <td>'s</td>
    </tr>
    <tr>
      <th>ghost</th>
      <td>dobj</td>
      <td>my mother's ghost</td>
    </tr>
    <tr>
      <th>.</th>
      <td>punct</td>
      <td>.</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="putting-everything-together">
<h2><span class="section-number">2.5. </span>Putting Everything Together<a class="headerlink" href="#putting-everything-together" title="Permalink to this headline">¶</a></h2>
<p>Now that we’ve walked through all these options (which are really only a small sliver of what you can do with <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>!), let’s put them into action. Below, we’ll construct two short examples of how you might combine different aspects of token attributes to analyze a text.</p>
<div class="section" id="finding-lemmas">
<h3><span class="section-number">2.5.1. </span>Finding lemmas<a class="headerlink" href="#finding-lemmas" title="Permalink to this headline">¶</a></h3>
<p>In the first, we’ll use the <code class="docutils literal notranslate"><span class="pre">.lemma_</span></code> attribute to search through Book XI of <em>The Odyssey</em> and match its tokens to a few key words. If you’ve read <em>The Odyssey</em>, you’ll know that Book XI is where Odysseus and his fellow sailors have to travel down to the underworld Hades, where they speak with the dead. We already saw one example of this: Odysseus attempts to embrace his dead mother after communing with her. The whole trip to Hades is an emotionally tumultuous experience for the travelers, and peppered throughout Book XI are expressions of grief.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">.lemma</span></code>, we can search for these expressions. We’ll roll through the text and determine whether a token lemma matches one of a selected set. When we find a match, we’ll get the subtree of this token’s <em>head</em>. That is, we’ll find the head upon which this token depends, and then we’ll use that to reconstruct the local context for the token.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sorrowful_lemmas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">odyssey</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">lemma_</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;cry&#39;</span><span class="p">,</span> <span class="s1">&#39;grief&#39;</span><span class="p">,</span> <span class="s1">&#39;grieve&#39;</span><span class="p">,</span> <span class="s1">&#39;sad&#39;</span><span class="p">,</span> <span class="s1">&#39;sorrow&#39;</span><span class="p">,</span> <span class="s1">&#39;tear&#39;</span><span class="p">,</span> <span class="s1">&#39;weep&#39;</span><span class="p">):</span>
        <span class="n">subtree</span> <span class="o">=</span> <span class="n">subtree_to_text</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">subtree</span><span class="p">)</span>
        <span class="n">sorrowful_lemmas</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;SUBTREE&#39;</span><span class="p">:</span> <span class="n">subtree</span>
        <span class="p">})</span>

<span class="n">sorrowful_lemmas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sorrowful_lemmas</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">sorrowful_lemmas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUBTREE</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>weeping</th>
      <td>weeping and in great distress of mind</td>
    </tr>
    <tr>
      <th>cried</th>
      <td>cried when I saw him: 'Elpenor</td>
    </tr>
    <tr>
      <th>sad</th>
      <td>sad</td>
    </tr>
    <tr>
      <th>tears</th>
      <td>tears</td>
    </tr>
    <tr>
      <th>sorrow</th>
      <td>all my sorrow</td>
    </tr>
    <tr>
      <th>sad</th>
      <td>sad</td>
    </tr>
    <tr>
      <th>tears</th>
      <td>tears</td>
    </tr>
    <tr>
      <th>grieves</th>
      <td>He grieves continually about your never having...</td>
    </tr>
    <tr>
      <th>sad</th>
      <td>sad</td>
    </tr>
    <tr>
      <th>sorrows</th>
      <td>our sorrows</td>
    </tr>
    <tr>
      <th>grief</th>
      <td>grief</td>
    </tr>
    <tr>
      <th>grief</th>
      <td>great grief</td>
    </tr>
    <tr>
      <th>grief</th>
      <td>grief</td>
    </tr>
    <tr>
      <th>sadder</th>
      <td>still sadder</td>
    </tr>
    <tr>
      <th>weeping</th>
      <td>weeping</td>
    </tr>
    <tr>
      <th>wept</th>
      <td>I too wept and pitied him as I beheld him. '</td>
    </tr>
    <tr>
      <th>weeping</th>
      <td>weeping and talking thus sadly with one another</td>
    </tr>
    <tr>
      <th>tear</th>
      <td>a tear</td>
    </tr>
    <tr>
      <th>cries</th>
      <td>such appalling cries</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="verb-subject-relations">
<h3><span class="section-number">2.5.2. </span>Verb-subject relations<a class="headerlink" href="#verb-subject-relations" title="Permalink to this headline">¶</a></h3>
<p>For this next example, we’ll use dependency tags to find the subject sentences in Book XI. As before, we’ll go through each token in the document, this time checking to see whether it has the <code class="docutils literal notranslate"><span class="pre">nsubj</span></code> or <code class="docutils literal notranslate"><span class="pre">nsubjpass</span></code> tag for its <code class="docutils literal notranslate"><span class="pre">.dep_</span></code> attribute. These refer to the subjects of the sentence’s root. We’ll also check to see whether a token is a noun (otherwise we’d get a lot of articles like ‘who’, ‘them’, etc.). If a token matches these two conditions, we’ll find its head verb as well as the token’s subtree. Note that this time, the subtree will refer directly to the token in question, not to the head. This will let us capture some descriptive information about each sentence subject.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsubj</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">odyssey</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">dep_</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;nsubj&#39;</span><span class="p">,</span> <span class="s1">&#39;nsubjpass&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">pos_</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;NOUN&#39;</span><span class="p">,</span> <span class="s1">&#39;PROPN&#39;</span><span class="p">):</span>
        <span class="n">nsubj</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;SUBJECT&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;HEAD&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;HEAD_LEMMA&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">lemma_</span><span class="p">,</span>
            <span class="s1">&#39;SUBTREE&#39;</span><span class="p">:</span> <span class="n">subtree_to_text</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">subtree</span><span class="p">)</span>
        <span class="p">})</span>

<span class="n">nsubj_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">nsubj</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;SUBJECT&#39;</span><span class="p">)</span>
<span class="n">nsubj_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>HEAD</th>
      <th>HEAD_LEMMA</th>
      <th>SUBTREE</th>
    </tr>
    <tr>
      <th>SUBJECT</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Circe</th>
      <td>sent</td>
      <td>send</td>
      <td>Circe, that great and cunning goddess</td>
    </tr>
    <tr>
      <th>sails</th>
      <td>were</td>
      <td>be</td>
      <td>her sails</td>
    </tr>
    <tr>
      <th>sun</th>
      <td>went</td>
      <td>go</td>
      <td>the sun</td>
    </tr>
    <tr>
      <th>darkness</th>
      <td>was</td>
      <td>be</td>
      <td>darkness</td>
    </tr>
    <tr>
      <th>rays</th>
      <td>pierce</td>
      <td>pierce</td>
      <td>the rays of the sun</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Theseus</th>
      <td>came</td>
      <td>come</td>
      <td>Theseus and Pirithous glorious children of the...</td>
    </tr>
    <tr>
      <th>thousands</th>
      <td>came</td>
      <td>come</td>
      <td>so many thousands of ghosts</td>
    </tr>
    <tr>
      <th>Proserpine</th>
      <td>send</td>
      <td>send</td>
      <td>Proserpine</td>
    </tr>
    <tr>
      <th>ship</th>
      <td>went</td>
      <td>go</td>
      <td>the ship</td>
    </tr>
    <tr>
      <th>wind</th>
      <td>sprang</td>
      <td>spring</td>
      <td>a fair wind</td>
    </tr>
  </tbody>
</table>
<p>143 rows × 3 columns</p>
</div></div></div>
</div>
<p>How many time do each of our selected subjects appear?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsubj_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;SUBJECT&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SUBJECT
ghost           8
Ulysses         5
ghosts          4
heaven          4
wife            4
Proserpine      4
man             4
one             4
Alcinous        3
people          3
Neleus          2
ship            2
judgement       2
Theseus         2
Teiresias       2
gods            2
mother          2
life            2
wind            2
Circe           2
Clytemnestra    2
Hercules        2
Jove            2
creature        2
prisoners       1
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>What heads are associated with each subject? (Note that we’re using the lemmatized form of the verbs.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsubj_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;SUBJECT&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD_LEMMA&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SUBJECT     HEAD_LEMMA
ghost       come          3
Ulysses     answer        2
Proserpine  send          2
one         invite        1
man         do            1
            kill          1
mother      answer        1
            come          1
one         be            1
            get           1
Aegisthus   be            1
man         be            1
one         tell          1
others      fall          1
people      be            1
            bless         1
            hear          1
man         cross         1
limbs       fail          1
property    be            1
heaven      take          1
ground      reek          1
guest       be            1
guests      sit           1
hardship    reach         1
dtype: int64
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "nlp"
        },
        kernelOptions: {
            kernelName: "nlp",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'nlp'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="01_logistics.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title"><span class="section-number">1. </span>Logistics</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="03_classification-and-feature-engineering.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title"><span class="section-number">3. </span>Classification and Feature Engineering</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Tyler Shoemaker and Carl Stahmer<br/>
        
          <div class="extra_footer">
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">
  <img alt="CC BY-SA 4.0" src="https://img.shields.io/badge/License-CC_BY--SA_4.0-lightgrey.svg"> 
</a>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>
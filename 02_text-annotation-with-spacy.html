
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2. Text Annotation with spaCy &#8212; Natural Language Processing with Python</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Classification and Feature Engineering" href="03_classification-and-feature-engineering.html" />
    <link rel="prev" title="1. Before We Begin…" href="01_logistics.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/datalab-logo-full-color-rgb.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Natural Language Processing with Python</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Overview
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_logistics.html">
   1. Before We Begin…
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   2. Text Annotation with spaCy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_classification-and-feature-engineering.html">
   3. Classification and Feature Engineering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_word-embeddings.html">
   4. Word Embeddings
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ucdavisdatalab/workshop_nlp_with_python/master?urlpath=tree/02_text-annotation-with-spacy.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ucdavisdatalab/workshop_nlp_with_python"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ucdavisdatalab/workshop_nlp_with_python/issues/new?title=Issue%20on%20page%20%2F02_text-annotation-with-spacy.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/02_text-annotation-with-spacy.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nlp-vs-text-mining-in-brief">
   2.1. NLP vs. Text Mining: In Brief
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-structures">
     2.1.1. Data structures
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-driven-methods">
     2.1.2. Model-driven methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spacy-language-models">
   2.2. spaCy Language Models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spacy-pipelines">
     2.2.1.
     <code class="docutils literal notranslate">
      <span class="pre">
       spaCy
      </span>
     </code>
     pipelines
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#downloading-a-model">
     2.2.2. Downloading a model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#annotations">
   2.3. Annotations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#document-annotations">
     2.3.1. Document Annotations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#token-annotations">
     2.3.2. Token Annotations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-of-speech-tagging">
   2.4. Part-of-Speech Tagging
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-case-word-sense-disambiguation">
     2.4.1. Use case: word sense disambiguation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dependency-parsing">
   2.5. Dependency Parsing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#putting-everything-together">
   2.6. Putting Everything Together
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-lemmas">
     2.6.1. Finding lemmas
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verb-subject-relations">
     2.6.2. Verb-subject relations
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Text Annotation with spaCy</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nlp-vs-text-mining-in-brief">
   2.1. NLP vs. Text Mining: In Brief
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-structures">
     2.1.1. Data structures
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-driven-methods">
     2.1.2. Model-driven methods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spacy-language-models">
   2.2. spaCy Language Models
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spacy-pipelines">
     2.2.1.
     <code class="docutils literal notranslate">
      <span class="pre">
       spaCy
      </span>
     </code>
     pipelines
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#downloading-a-model">
     2.2.2. Downloading a model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#annotations">
   2.3. Annotations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#document-annotations">
     2.3.1. Document Annotations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#token-annotations">
     2.3.2. Token Annotations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-of-speech-tagging">
   2.4. Part-of-Speech Tagging
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-case-word-sense-disambiguation">
     2.4.1. Use case: word sense disambiguation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dependency-parsing">
   2.5. Dependency Parsing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#putting-everything-together">
   2.6. Putting Everything Together
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finding-lemmas">
     2.6.1. Finding lemmas
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#verb-subject-relations">
     2.6.2. Verb-subject relations
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="text-annotation-with-spacy">
<h1><span class="section-number">2. </span>Text Annotation with spaCy<a class="headerlink" href="#text-annotation-with-spacy" title="Permalink to this headline">#</a></h1>
<p>This chapter introduces workshop participants to the general field of natural language processing, or NLP. While NLP is often used interchangeably with text mining/analytics in introductory settings, the former differs in important ways from many of the core methods in the latter. We will highlight a few such differences over the course of this session, and then more generally throughout the workshop series as a whole.</p>
<div class="admonition-learning-objectives admonition">
<p class="admonition-title">Learning objectives</p>
<p>By the end of this chapter, you will be able to:</p>
<ul class="simple">
<li><p>Explain how document annotation differs from other representations of text data</p></li>
<li><p>Have a general sense of how <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> models and their respective pipelines work</p></li>
<li><p>Extract linguistic information about text using <code class="docutils literal notranslate"><span class="pre">spaCy</span></code></p></li>
<li><p>Describe key terms in NLP, like part-of-speech tagging, dependency parsing, etc.</p></li>
<li><p>Know how/where to look for more information about the linguistic data <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> makes available</p></li>
</ul>
</div>
<section id="nlp-vs-text-mining-in-brief">
<h2><span class="section-number">2.1. </span>NLP vs. Text Mining: In Brief<a class="headerlink" href="#nlp-vs-text-mining-in-brief" title="Permalink to this headline">#</a></h2>
<p>The short space of this reader, as well as that of our series, necessarily limits a conversation about everything that characterizes NLP from text mining/analytics. That there are differences at all is in itself worth noting and merits further exploration. But for the purposes of this series’s focus, there are two such instances of these differences that are especially worth calling out.</p>
<section id="data-structures">
<h3><span class="section-number">2.1.1. </span>Data structures<a class="headerlink" href="#data-structures" title="Permalink to this headline">#</a></h3>
<p>At the outset, one way of distinguishing NLP from text mining has to do with NLP’s underlying <strong>data structure</strong>. Generally speaking, NLP methods are <strong>maximally preservative</strong> when it comes to representing textual information in a way computers can read. Unlike text mining’s atomizing focus on <strong>bags of words</strong>, in NLP we often use literal transcriptions of the input text and run our analyses directly on that. This is because much of the information NLP methods provide is context-sensitive: we need to know, for example, the subject of a sentence in order to do dependency parsing; part-of-speech taggers are most effective when they have surrounding tokens to consider. Accordingly, our workflow needs to retain as much information about our documents as possible, for as long as possible. In fact, many NLP methods <em>build on each other</em>, so data about our documents will grow over the course of processing them (rather than getting pared down, as with text mining). The dominant paradigm, then, for thinking about how text data is represented in NLP is <strong>annotation</strong>: NLP tends to add, associate, or tag documents with extra information.</p>
</section>
<section id="model-driven-methods">
<h3><span class="section-number">2.1.2. </span>Model-driven methods<a class="headerlink" href="#model-driven-methods" title="Permalink to this headline">#</a></h3>
<p>The other key difference between text mining and NLP – which goes hand-in-hand with the idea of annotation – lies in the fact that the latter tends to be more <strong>model-driven</strong>. NLP methods often rely on statistical models to create the above information, and ultimately these models have a lot of assumptions baked into them. Such assumptions range from philosophy of language (how do we know we’re analyzing meaning?) to the kind of training data on which they’re trained (what does the model represent, and what biases might thereby be involved?). Of course, it’s possible to build your own models, and indeed a later chapter will show you how to do so, but you’ll often find yourself using other researchers’ models when doing NLP work. It’s thus very important to know how researchers have built their models so you can do your own work responsibly.</p>
<div class="admonition-keep-in-mind admonition">
<p class="admonition-title">Keep in mind</p>
<p>Throughout this series, we will be using NLP methods in the context of text-based data, but NLP applies more widely to speech data as well.</p>
</div>
</section>
</section>
<section id="spacy-language-models">
<h2><span class="section-number">2.2. </span>spaCy Language Models<a class="headerlink" href="#spacy-language-models" title="Permalink to this headline">#</a></h2>
<aside class="margin sidebar">
<p class="sidebar-title">Want to know more?</p>
<p>Explosion, the company behind <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>, has a series of useful videos introducing the framework. <a class="reference external" href="https://www.youtube.com/watch?v=9k_EfV7Cns0&amp;t=1365s">This one</a> is a good place to start.</p>
</aside>
<p>Much of this workshop series will use language models from <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>, one of the most popular NLP libraries in Python. <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> is both a framework and a model resource. It offers access to models through a unique set of coding workflows, which we’ll discuss below (you can also train your own models with the library). Learning about these workflows will help us add annotate documents with extra information that will, in turn, enable us to perform a number of different NLP tasks.</p>
<section id="spacy-pipelines">
<h3><span class="section-number">2.2.1. </span><code class="docutils literal notranslate"><span class="pre">spaCy</span></code> pipelines<a class="headerlink" href="#spacy-pipelines" title="Permalink to this headline">#</a></h3>
<p>In essence, a <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> model is a collection of sub-models arranged into a <strong>pipeline</strong>. The idea here is that you send a document through this pipeline, and the model does the work of annotating your document. Once it has finished, you can access these annotations to perform whatever analysis you’d like to do.</p>
<p><img alt="" src="_images/spacy_pipeline.png" /></p>
<p>Every component, or <strong>pipe</strong>, in a <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> pipeline performs a different task, from tokenization to part-of-speeching tagging and named-entity recognition. Each model comes with a specific ordering of these tasks, but you can mix and match them after the fact, adding or removing pipes as you see fit. The result is a wide set of options; the present workshop series only samples a few core aspects of the library’s overall capabilities.</p>
</section>
<section id="downloading-a-model">
<h3><span class="section-number">2.2.2. </span>Downloading a model<a class="headerlink" href="#downloading-a-model" title="Permalink to this headline">#</a></h3>
<p>The specific model we’ll be using is <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>’s medium-sized English model: <a class="reference external" href="https://github.com/explosion/spacy-models/releases/tag/en_core_web_sm-3.3.0">en_core_web_md</a>. It’s been trained on the <a class="reference external" href="https://catalog.ldc.upenn.edu/LDC2013T19">OntoNotes</a> corpus and it features several useful pipes, which we’ll discuss below.</p>
<p>If you haven’t used <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> before, you’ll need to download this model. You can do so by running the following in a command line interface:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python -m spacy download en_core_web_md
</pre></div>
</div>
<p>Just be sure you run this while working in the Python environment you’d like to use!</p>
<p>Once this downloads, you can load the model with the code below. Note that it’s conventional to assign the model to a variable called <code class="docutils literal notranslate"><span class="pre">nlp</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;en_core_web_md&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="annotations">
<h2><span class="section-number">2.3. </span>Annotations<a class="headerlink" href="#annotations" title="Permalink to this headline">#</a></h2>
<p>With the model loaded, we can send a document through the pipeline, which will in turn produce our text annotations. To annotate a document with the <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> model, simply run it through the core function, <code class="docutils literal notranslate"><span class="pre">nlp()</span></code>. We’ll do so with a short poem by Gertrude Stein.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/session_one/stein_carafe.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">stein_poem</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    
<span class="n">carafe</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">stein_poem</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With this done, we can inspect the result…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A kind in glass and a cousin, a spectacle and nothing strange a single hurt color and an arrangement in a system to pointing. All this and not ordinary, not unordered in not resembling. The difference is spreading.
</pre></div>
</div>
</div>
</div>
<p>…which seems to be no different from a string representation! This output is a bit misleading, however. Our <code class="docutils literal notranslate"><span class="pre">carafe</span></code> object actually has a ton of extra information associated with it, even though, on the surface, it appears to be a plain old string.</p>
<p>If you’d like, you can inspect all these attributes and methods with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">carafe</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We won’t show them all here, but suffice it to say, there are a lot!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of attributes in a SpaCy doc:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of attributes in a SpaCy doc: 51
</pre></div>
</div>
</div>
</div>
<p>This high number of attributes indicates an important point to keep in mind when working with <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> and NLP generally: as we mentioned before, the primary data model for NLP aims to <strong>maximally preserve information</strong> about your document. It keeps documents intact and in fact adds much more information about them than Python’s base string methods have. In this sense, we might say that <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> is additive in nature, whereas text mining methods are subtractive, or reductive.</p>
<section id="document-annotations">
<h3><span class="section-number">2.3.1. </span>Document Annotations<a class="headerlink" href="#document-annotations" title="Permalink to this headline">#</a></h3>
<p>So, while the base representation of <code class="docutils literal notranslate"><span class="pre">carafe</span></code> looks like a string, under the surface there are all sorts of annotations about it. To access them, we use the attributes counted above. For example, <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> adds extra segmentation information about a document, like which parts of it belong to different sentences. We can check to see whether this information has been attached to our text with the <code class="docutils literal notranslate"><span class="pre">.has_annotation()</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="o">.</span><span class="n">has_annotation</span><span class="p">(</span><span class="s1">&#39;SENT_START&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>We can use the same method to check for a few other annotations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annotation_types</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Dependencies&#39;</span><span class="p">:</span> <span class="s1">&#39;DEP&#39;</span><span class="p">,</span> <span class="s1">&#39;Entities&#39;</span><span class="p">:</span> <span class="s1">&#39;ENT_IOB&#39;</span><span class="p">,</span> <span class="s1">&#39;Tags&#39;</span><span class="p">:</span> <span class="s1">&#39;TAG&#39;</span><span class="p">}</span>
<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">annotation_types</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">:</span><span class="s2">&gt;12</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">carafe</span><span class="o">.</span><span class="n">has_annotation</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dependencies: True
    Entities: True
        Tags: True
</pre></div>
</div>
</div>
</div>
<p>Let’s look at sentences. We can access them with <code class="docutils literal notranslate"><span class="pre">.sents</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="o">.</span><span class="n">sents</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;generator at 0x125145ea0&gt;
</pre></div>
</div>
</div>
</div>
<p>…but you can see that there’s a small complication here: <code class="docutils literal notranslate"><span class="pre">.sents</span></code> returns a generator, not a list. The reason has to do with memory efficiency. Because <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> adds so much extra information about your document, this information could slow down your code or overwhelm your computer if the library didn’t store it in an efficient manner. Of course this isn’t a problem with our small poem, but you can imagine how it could become one with a big corpus.</p>
<p>To access the actual sentences in <code class="docutils literal notranslate"><span class="pre">carafe</span></code>, we’ll need to convert the generator to a list.</p>
<aside class="margin sidebar">
<p class="sidebar-title">Want to learn more about generators?</p>
<p>The DataLab has a workshop about them. See <a class="reference external" href="https://datalab.ucdavis.edu/eventscalendar/intermediate-python-iterator-generator-crash-course/">this link</a>.</p>
</aside>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">textwrap</span>

<span class="n">sentences</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">carafe</span><span class="o">.</span><span class="n">sents</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">shorten</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A kind in glass and a cousin, a spectacle and nothing strange a single hurt color and an [...]
All this and not ordinary, not unordered in not resembling.
The difference is spreading.
</pre></div>
</div>
</div>
</div>
<p>One very useful attribute is <code class="docutils literal notranslate"><span class="pre">.noun_chunks</span></code>. It returns nouns and compound nouns in a document.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noun_chunks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">carafe</span><span class="o">.</span><span class="n">noun_chunks</span><span class="p">)</span>

<span class="k">for</span> <span class="n">noun</span> <span class="ow">in</span> <span class="n">noun_chunks</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">noun</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A kind
glass
a cousin
a spectacle
nothing
a single hurt color
an arrangement
a system
All this
The difference
</pre></div>
</div>
</div>
</div>
<p>See how this picks up not only nouns, but articles and compound information? Articles could be helpful if you wanted to track singular/plural relationships, while compound nouns might tell you something about the way a document refers to the entities therein. The latter could have repeating patterns, and you might imagine how you could use noun chunks to create and count n-gram tokens and feed that into a classifier.</p>
<p>Consider this example from <em>The Odyssey</em>. Homer used many epithets and repeating phrases throughout his epic. According to some theories, these act as mnemonic devices, helping a performer keep everything in their head during an oral performance (the poem wasn’t written down in Homer’s day). Using <code class="docutils literal notranslate"><span class="pre">.noun_chunks</span></code> in conjunction with a Python <code class="docutils literal notranslate"><span class="pre">Counter</span></code>, we may be able to identify these in Homer’s text. Below, we’ll do so with <em>The Odyssey</em> Book XI.</p>
<p>First, let’s load and model the text.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/session_one/odyssey_book_11.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">book_eleven</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    
<span class="n">odyssey</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">book_eleven</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we’ll import a <code class="docutils literal notranslate"><span class="pre">Counter</span></code> and initialize it. Then we’ll get the noun chunks from the document and populate them in the count dictionary with a list comprehension line. Be sure to only grab the text from each token. We’ll explain why in a little while.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">noun_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="n">chunk</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">odyssey</span><span class="o">.</span><span class="n">noun_chunks</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>With that done, let’s look for repeating noun chunks with three or more words.</p>
<aside class="margin sidebar">
<p class="sidebar-title">What we’re doing here…</p>
<p>For every noun chunk in the counter:</p>
<ol class="simple">
<li><p>Split the chunk</p></li>
<li><p>Check if the length of the chunk is more than two and the count is more than one</p></li>
<li><p>If so, join the chunk back together and print it along with the chunk</p></li>
</ol>
</aside>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">chunk</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">noun_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">joined</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;PHRASE&#39;</span><span class="p">:</span> <span class="n">joined</span><span class="p">,</span>
            <span class="s1">&#39;COUNT&#39;</span><span class="p">:</span> <span class="n">count</span>
        <span class="p">})</span>
        
<span class="n">chunks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;PHRASE&#39;</span><span class="p">)</span>
<span class="n">chunks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COUNT</th>
    </tr>
    <tr>
      <th>PHRASE</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>the sea shore</th>
      <td>2</td>
    </tr>
    <tr>
      <th>a fair wind</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the poor feckless ghosts</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the same time</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the other side</th>
      <td>2</td>
    </tr>
    <tr>
      <th>his golden sceptre</th>
      <td>2</td>
    </tr>
    <tr>
      <th>your own house</th>
      <td>2</td>
    </tr>
    <tr>
      <th>her own son</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the Achaean land</th>
      <td>2</td>
    </tr>
    <tr>
      <th>her own husband</th>
      <td>2</td>
    </tr>
    <tr>
      <th>my wicked wife</th>
      <td>2</td>
    </tr>
    <tr>
      <th>all the Danaans</th>
      <td>2</td>
    </tr>
    <tr>
      <th>the poor creature</th>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Excellent! Looks like we turned up a few: “the poor feckless ghosts,” “my wicked wife,” and “all the Danaans” are likely the kind of repeating phrases scholars think of in Homer’s text.</p>
<p>Another way to look at entities in a text is with <code class="docutils literal notranslate"><span class="pre">.ents</span></code>. <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> uses <strong>named-entity recognition</strong> to extract significant objects, or entities, in a document. In general, anything that has a proper name associated with it is considered an entity, but things like expressions of time and geographic location are also often tagged. Here are the first five from Book XI above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">entities</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">odyssey</span><span class="o">.</span><span class="n">ents</span><span class="p">)</span>

<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">entities</span><span class="p">[</span><span class="n">count</span><span class="p">])</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Circe
Circe
Here Perimedes and Eurylochus
first
thirdly
</pre></div>
</div>
</div>
</div>
<p>You can select particular entities using the <code class="docutils literal notranslate"><span class="pre">.label_</span></code> attribute. Here are all the temporal entities in Book XI.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">odyssey</span><span class="o">.</span><span class="n">ents</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">label_</span> <span class="o">==</span> <span class="s1">&#39;TIME&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;morning&#39;]
</pre></div>
</div>
</div>
</div>
<p>And here is a unique listing of all the people.</p>
<aside class="margin sidebar">
<p class="sidebar-title">How many labels are there?</p>
<p>This will depend on the model. Here’s the <a class="reference external" href="https://spacy.io/models/en#en_core_web_md-labels">label scheme</a> for the one we’re using.</p>
</aside>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">odyssey</span><span class="o">.</span><span class="n">ents</span> <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">label_</span> <span class="o">==</span> <span class="s1">&#39;PERSON&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;Achilles&#39;,
 &#39;Anticlea&#39;,
 &#39;Ariadne&#39;,
 &#39;Bacchus&#39;,
 &#39;Chloris&#39;,
 &#39;Circe&#39;,
 &#39;Cretheus&#39;,
 &#39;Dia&#39;,
 &#39;Diana&#39;,
 &#39;Echeneus&#39;,
 &#39;Epeus&#39;,
 &#39;Ephialtes&#39;,
 &#39;Erebus&#39;,
 &#39;Eriphyle&#39;,
 &#39;Gorgon&#39;,
 &#39;Hades&#39;,
 &#39;Hebe&#39;,
 &#39;Helen&#39;,
 &#39;Hercules&#39;,
 &#39;Ithaca&#39;,
 &#39;Jove&#39;,
 &#39;Leto&#39;,
 &#39;Maera&#39;,
 &#39;Megara&#39;,
 &#39;Memnon&#39;,
 &#39;Minerva&#39;,
 &#39;Neleus&#39;,
 &#39;Neptune&#39;,
 &#39;Pelias&#39;,
 &#39;Penelope&#39;,
 &#39;Pero&#39;,
 &#39;Pollux&#39;,
 &#39;Priam&#39;,
 &#39;Proserpine&#39;,
 &#39;Pylos&#39;,
 &#39;Queen&#39;,
 &#39;Salmoneus&#39;,
 &#39;Sisyphus&#39;,
 &#39;Telemachus&#39;,
 &#39;Theban&#39;,
 &#39;Theban Teiresias&#39;,
 &#39;Thebes&#39;,
 &#39;Theseus&#39;,
 &#39;Thetis&#39;,
 &#39;Troy&#39;,
 &#39;Tyro&#39;,
 &#39;Ulysses&#39;,
 &#39;jailor Hades&#39;}
</pre></div>
</div>
</div>
</div>
<p>Don’t see an entity that you know to be in your document? You can add more to the <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> model. Doing so is beyond the scope of our workshop session, but the library’s <code class="docutils literal notranslate"><span class="pre">EntityRuler()</span></code> <a class="reference external" href="https://spacy.io/api/entityruler">documentation</a> will show you how.</p>
</section>
<section id="token-annotations">
<h3><span class="section-number">2.3.2. </span>Token Annotations<a class="headerlink" href="#token-annotations" title="Permalink to this headline">#</a></h3>
<p>In addition to storing all of this information about texts, <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> creates a substantial amount of annotations for each of the tokens in that document. The same logic as above applies to accessing this information.</p>
<p>Let’s return to the Stein poem. Indexing <code class="docutils literal notranslate"><span class="pre">carafe</span></code> will return individual tokens:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>glass
</pre></div>
</div>
</div>
</div>
<p>Like <code class="docutils literal notranslate"><span class="pre">carafe</span></code>, each one has several attributes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">token_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of token attributes:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">token_attributes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of token attributes: 94
</pre></div>
</div>
</div>
</div>
<p>That’s a lot!</p>
<p>These attributes range from simple booleans, like whether a token is an alphabetic character:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">is_alpha</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>…or whether it is a stop word:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">is_stop</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>…to more complex pieces of information, like tracking back to the sentence this token is part of:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">sent</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A kind in glass and a cousin, a spectacle and nothing strange a single hurt color and an arrangement in a system to pointing.
</pre></div>
</div>
</div>
</div>
<p>…sentiment scores:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">sentiment</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>…and even vector space representations (more about these on day three!):</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">carafe</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">vector</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-0.60665  , -0.19688  , -0.1227   , -0.63598  ,  0.89807  ,
       -0.26537  , -0.015889 ,  0.28961  , -0.10494  , -0.46685  ,
        0.36891  ,  0.15006  , -0.22227  ,  0.38622  ,  0.29493  ,
       -0.9845   , -0.32567  ,  0.23355  ,  0.49492  , -0.57569  ,
       -0.10022  ,  0.2888   ,  0.786    , -0.054396 ,  0.14151  ,
       -0.40768  ,  0.061544 ,  0.39313  , -1.092    , -0.14511  ,
        0.42103  , -0.76163  ,  0.29339  ,  0.41215  , -0.41869  ,
        0.39918  ,  0.39688  , -0.46966  ,  0.74839  ,  0.50759  ,
        0.48458  ,  0.51865  ,  0.20757  , -0.32406  ,  0.72689  ,
       -0.31903  , -0.23761  , -0.6614   ,  0.28486  ,  0.44251  ,
        0.10102  , -0.26663  ,  0.55344  ,  0.26378  , -0.41728  ,
       -0.30876  ,  0.41034  , -0.54028  , -0.42292  ,  0.22636  ,
        0.31144  ,  0.27504  ,  0.18149  ,  0.21325  , -0.55227  ,
       -0.1011   ,  0.25542  ,  0.45925  ,  0.60463  ,  0.35682  ,
        0.56958  ,  0.036307 ,  0.83937  ,  0.48093  , -0.19525  ,
        0.46602  ,  0.022897 ,  0.11539  , -0.24179  ,  0.48036  ,
       -1.0714   , -0.36915  ,  0.16971  , -0.053726 , -0.97381  ,
        0.42214  ,  1.1142   ,  1.4597   , -0.50529  , -0.45446  ,
        0.41132  , -0.33779  ,  0.32959  ,  0.49328  ,  0.56425  ,
        0.012859 ,  0.25048  , -0.87307  , -0.21436  , -0.20508  ,
        0.42198  , -0.22507  , -0.53125  ,  0.44767  , -0.18567  ,
       -1.3365   ,  0.089993 , -0.64042  ,  1.0186   ,  0.21136  ,
        0.19435  ,  0.17786  , -0.13835  , -0.37329  ,  0.31726  ,
        0.16039  , -0.19666  ,  0.049621 ,  0.094966 , -0.037447 ,
       -0.29013  ,  0.48434  , -0.12724  ,  0.67386  ,  0.32174  ,
       -0.32181  , -0.16145  , -0.60097  ,  0.60743  ,  0.22665  ,
       -0.28438  , -0.29495  ,  0.04462  , -0.013322 ,  0.11204  ,
        0.63518  , -0.022868 , -0.034192 , -0.20114  ,  0.11167  ,
       -0.37905  ,  0.36819  , -0.018246 ,  0.25284  , -0.088927 ,
       -0.077314 , -0.35745  ,  0.14237  ,  0.14386  ,  0.24076  ,
       -0.29973  , -0.03639  ,  0.22725  ,  0.10916  , -0.94986  ,
        0.046044 ,  0.81856  , -0.33634  , -0.15261  ,  0.60717  ,
       -0.2718   ,  0.22678  , -0.18739  ,  0.623    ,  0.82995  ,
       -0.20024  ,  0.73056  , -0.0084901, -0.39045  ,  0.18742  ,
       -0.73338  , -0.077664 ,  0.23246  ,  0.87546  ,  0.21647  ,
       -0.072898 ,  0.36288  ,  0.2308   , -0.30565  ,  0.11694  ,
       -0.33983  , -0.15152  ,  0.92947  ,  0.58747  , -0.12973  ,
        0.005775 , -0.092589 ,  0.18885  , -0.40725  ,  0.18249  ,
       -0.90487  , -0.42429  ,  0.099451 , -0.61899  , -0.060563 ,
        0.16057  , -0.43026  ,  0.33288  ,  0.5276   ,  0.16662  ,
       -0.11755  ,  0.17048  ,  0.20785  , -0.18347  ,  0.35685  ,
       -0.07018  , -0.064295 ,  0.46135  , -0.0083938, -0.24064  ,
       -0.18537  ,  0.067484 , -0.072876 , -0.80117  ,  0.11181  ,
        0.43282  ,  0.58373  , -0.31169  ,  0.032395 ,  0.33231  ,
        0.086075 ,  0.14476  ,  0.081413 ,  0.31666  , -0.49782  ,
       -0.15804  ,  0.3573   , -0.56534  , -0.58402  ,  0.023733 ,
       -0.29734  ,  0.13347  , -0.12673  ,  0.44492  , -0.33062  ,
       -0.50343  ,  0.43491  ,  0.028932 ,  0.17392  , -0.26669  ,
        0.020031 ,  0.91117  , -0.069201 ,  0.49468  ,  0.043936 ,
        0.083269 ,  0.14409  ,  0.15961  , -0.54771  ,  0.38417  ,
        0.51976  ,  0.17693  ,  0.36414  , -0.11335  , -0.078741 ,
       -0.41143  , -0.15808  ,  0.086959 ,  0.20845  ,  0.27017  ,
        0.018805 ,  1.2245   ,  0.12708  ,  0.25326  ,  0.10445  ,
       -0.058079 , -0.030512 ,  0.63189  , -0.56298  , -0.25331  ,
       -0.64939  , -0.48705  ,  0.18973  , -0.39923  ,  0.78043  ,
       -0.13467  ,  0.14517  ,  0.48435  ,  0.51201  , -0.80074  ,
       -0.42834  ,  0.17614  ,  0.59832  , -0.37692  ,  0.029607 ,
        0.09632  ,  0.40852  ,  0.62755  , -0.038655 ,  0.17166  ,
        0.451    ,  0.20851  ,  0.267    ,  0.24261  , -0.23774  ,
       -0.48429  ,  0.24286  , -0.20696  , -0.25682  , -0.1432   ],
      dtype=float32)
</pre></div>
</div>
</div>
</div>
<p>Here’s a listing of some attributes you might want to know about when text mining.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_attributes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span><span class="p">:</span>
    <span class="n">sample_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;INDEX&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
        <span class="s1">&#39;TEXT&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s1">&#39;LOWERCASE&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">lower_</span><span class="p">,</span>
        <span class="s1">&#39;ALPHABETIC&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">is_alpha</span><span class="p">,</span>
        <span class="s1">&#39;DIGIT&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">is_digit</span><span class="p">,</span>
        <span class="s1">&#39;PUNCTUATION&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">is_punct</span><span class="p">,</span>
        <span class="s1">&#39;STARTS SENTENCE&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">is_sent_start</span><span class="p">,</span>
        <span class="s1">&#39;LIKE URL&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">like_url</span>
    <span class="p">})</span>

<span class="n">sample_attributes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sample_attributes</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;INDEX&#39;</span><span class="p">)</span>
<span class="n">sample_attributes</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TEXT</th>
      <th>LOWERCASE</th>
      <th>ALPHABETIC</th>
      <th>DIGIT</th>
      <th>PUNCTUATION</th>
      <th>STARTS SENTENCE</th>
      <th>LIKE URL</th>
    </tr>
    <tr>
      <th>INDEX</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>a</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>kind</td>
      <td>kind</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>in</td>
      <td>in</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>glass</td>
      <td>glass</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>and</td>
      <td>and</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>a</td>
      <td>a</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>6</th>
      <td>cousin</td>
      <td>cousin</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>7</th>
      <td>,</td>
      <td>,</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>8</th>
      <td>a</td>
      <td>a</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>9</th>
      <td>spectacle</td>
      <td>spectacle</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We’ll discuss some of the more complex annotations later on, both in this session and others. For now, let’s collect some simple information about each of the tokens in our document. We’ll use list comprehension to do so. We’ll also use the <code class="docutils literal notranslate"><span class="pre">.text</span></code> attribute for each token, since we only want the text representation. Otherwise, we’d be creating a list of generators, where each generator has all those attribute for every token! (This is why we made sure to only use <code class="docutils literal notranslate"><span class="pre">.text</span></code> in our work with <em>The Odyssey</em> above.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">words</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_alpha</span><span class="p">])</span>
<span class="n">punctuation</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span> <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_punct</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Words</span><span class="se">\n</span><span class="s2">-----</span><span class="se">\n</span><span class="si">{</span><span class="n">textwrap</span><span class="o">.</span><span class="n">shorten</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Punctuation</span><span class="se">\n</span><span class="s2">-----------</span><span class="se">\n</span><span class="si">{</span><span class="n">punctuation</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Words
-----
A kind in glass and a cousin a spectacle and nothing strange a single hurt color and an [...] 

Punctuation
-----------
, . , . .
</pre></div>
</div>
</div>
</div>
<p>Want some linguistic information? We can get that too. For example, here are prefixes and suffixes:</p>
<aside class="margin sidebar">
<p class="sidebar-title">You might be wondering about those underscores…</p>
<p>The syntax conventions of <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> use a trailing underscore to access the actual attribute information for a token. Using an attribute without the underscore will return an id, which the library uses internally to piece together output.</p>
</aside>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prefix_suffix</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_alpha</span><span class="p">:</span>
        <span class="n">prefix_suffix</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;PREFIX&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">prefix_</span><span class="p">,</span>
            <span class="s1">&#39;SUFFIX&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">suffix_</span>
        <span class="p">})</span>

<span class="n">prefix_suffix</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prefix_suffix</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">prefix_suffix</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PREFIX</th>
      <th>SUFFIX</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>A</td>
      <td>A</td>
    </tr>
    <tr>
      <th>kind</th>
      <td>k</td>
      <td>ind</td>
    </tr>
    <tr>
      <th>in</th>
      <td>i</td>
      <td>in</td>
    </tr>
    <tr>
      <th>glass</th>
      <td>g</td>
      <td>ass</td>
    </tr>
    <tr>
      <th>and</th>
      <td>a</td>
      <td>and</td>
    </tr>
    <tr>
      <th>a</th>
      <td>a</td>
      <td>a</td>
    </tr>
    <tr>
      <th>cousin</th>
      <td>c</td>
      <td>sin</td>
    </tr>
    <tr>
      <th>a</th>
      <td>a</td>
      <td>a</td>
    </tr>
    <tr>
      <th>spectacle</th>
      <td>s</td>
      <td>cle</td>
    </tr>
    <tr>
      <th>and</th>
      <td>a</td>
      <td>and</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>And here are lemmas:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lemmas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">is_alpha</span><span class="p">:</span>
        <span class="n">lemmas</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;LEMMA&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">lemma_</span>
        <span class="p">})</span>

<span class="n">lemmas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">lemmas</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">lemmas</span><span class="p">[</span><span class="mi">24</span><span class="p">:]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LEMMA</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>All</th>
      <td>all</td>
    </tr>
    <tr>
      <th>this</th>
      <td>this</td>
    </tr>
    <tr>
      <th>and</th>
      <td>and</td>
    </tr>
    <tr>
      <th>not</th>
      <td>not</td>
    </tr>
    <tr>
      <th>ordinary</th>
      <td>ordinary</td>
    </tr>
    <tr>
      <th>not</th>
      <td>not</td>
    </tr>
    <tr>
      <th>unordered</th>
      <td>unordered</td>
    </tr>
    <tr>
      <th>in</th>
      <td>in</td>
    </tr>
    <tr>
      <th>not</th>
      <td>not</td>
    </tr>
    <tr>
      <th>resembling</th>
      <td>resemble</td>
    </tr>
    <tr>
      <th>The</th>
      <td>the</td>
    </tr>
    <tr>
      <th>difference</th>
      <td>difference</td>
    </tr>
    <tr>
      <th>is</th>
      <td>be</td>
    </tr>
    <tr>
      <th>spreading</th>
      <td>spread</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>With such attributes at your disposal, you might imagine how you could work <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> into a text mining pipeline. Instead of using separate functions to clean your corpus, those steps could all be accomplished by accessing attributes.</p>
<p>Before you do this, however, you should consider two things: 1) whether the increased computational/memory overhead is worthwhile for your project; and 2) whether <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>’s base models will work for the kind of text you’re using. This second point is especially important. While <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>’s base models are incredibly powerful, they are built for general purpose applications and may struggle with domain-specific language. Medical text and early modern print are two such examples of where the base models interpret your documents in unexpected ways, thereby complicating, maybe even ruining, parts of a text mining pipeline that relies on them. Sometimes, in other words, it’s just best to stick with a text mining pipeline that you know to be effective.</p>
<p>That all said, there are ways to train your own <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> model on a specific domain. This can be an extensive process, one which exceeds the limits of our short workshop, but if you want to learn more about doing so, you can visit <a class="reference external" href="https://spacy.io/usage/training">this page</a>. There are also <a class="reference external" href="https://spacy.io/universe/category/models">third party models</a> available, which you might find useful, though your milage may vary.</p>
</section>
</section>
<section id="part-of-speech-tagging">
<h2><span class="section-number">2.4. </span>Part-of-Speech Tagging<a class="headerlink" href="#part-of-speech-tagging" title="Permalink to this headline">#</a></h2>
<p>One of the most common tasks in NLP involves assigning <strong>part-of-speech, or POS, tags</strong> to each token in a document. As we saw in the text mining series, these tags are a necessary step for certain text cleaning process, like lemmatization; you might also use them to identify subsets of your data, which you could separate out and model. Beyond text cleaning, POS tags can be useful for tasks like <strong>word sense disambiguation</strong>, where you try to determine which particular facet of meaning a given token represents.</p>
<p>Regardless of the task, the process of getting POS tags from <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> will be the same. Each token in a document has an associated tag, which is accessible as an attribute.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pos</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span><span class="p">:</span>
    <span class="n">pos</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s1">&#39;POS_TAG&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">pos_</span>
    <span class="p">})</span>

<span class="n">pos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">pos</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>POS_TAG</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>kind</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>in</th>
      <td>ADP</td>
    </tr>
    <tr>
      <th>glass</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CCONJ</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>cousin</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>,</th>
      <td>PUNCT</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>spectacle</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CCONJ</td>
    </tr>
    <tr>
      <th>nothing</th>
      <td>PRON</td>
    </tr>
    <tr>
      <th>strange</th>
      <td>ADJ</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>single</th>
      <td>ADJ</td>
    </tr>
    <tr>
      <th>hurt</th>
      <td>ADJ</td>
    </tr>
    <tr>
      <th>color</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CCONJ</td>
    </tr>
    <tr>
      <th>an</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>arrangement</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>in</th>
      <td>ADP</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>system</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>to</th>
      <td>ADP</td>
    </tr>
    <tr>
      <th>pointing</th>
      <td>VERB</td>
    </tr>
    <tr>
      <th>.</th>
      <td>PUNCT</td>
    </tr>
    <tr>
      <th>All</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>this</th>
      <td>PRON</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CCONJ</td>
    </tr>
    <tr>
      <th>not</th>
      <td>PART</td>
    </tr>
    <tr>
      <th>ordinary</th>
      <td>ADJ</td>
    </tr>
    <tr>
      <th>,</th>
      <td>PUNCT</td>
    </tr>
    <tr>
      <th>not</th>
      <td>PART</td>
    </tr>
    <tr>
      <th>unordered</th>
      <td>ADJ</td>
    </tr>
    <tr>
      <th>in</th>
      <td>ADP</td>
    </tr>
    <tr>
      <th>not</th>
      <td>PART</td>
    </tr>
    <tr>
      <th>resembling</th>
      <td>VERB</td>
    </tr>
    <tr>
      <th>.</th>
      <td>PUNCT</td>
    </tr>
    <tr>
      <th>The</th>
      <td>DET</td>
    </tr>
    <tr>
      <th>difference</th>
      <td>NOUN</td>
    </tr>
    <tr>
      <th>is</th>
      <td>AUX</td>
    </tr>
    <tr>
      <th>spreading</th>
      <td>VERB</td>
    </tr>
    <tr>
      <th>.</th>
      <td>PUNCT</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If you don’t know what a tag means, you can use <code class="docutils literal notranslate"><span class="pre">spacy.explain()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="s1">&#39;CCONJ&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;coordinating conjunction&#39;
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">spaCy</span></code> actually has two types of POS tags. The ones accessible with the <code class="docutils literal notranslate"><span class="pre">.pos_</span></code> attribute are the basic tags, whereas those under <code class="docutils literal notranslate"><span class="pre">.tag_</span></code> are more detailed (these come from the <a class="reference external" href="https://www.ling.upenn.edu/courses/Fall_2003/ling001/penn_treebank_pos.html">Penn Treebank project</a>). We’ll print them out below, along with information about what they mean.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">detailed_tags</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">carafe</span><span class="p">:</span>
    <span class="n">detailed_tags</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s1">&#39;POS_TAG&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="p">,</span>
        <span class="s1">&#39;EXPLANATION&#39;</span><span class="p">:</span> <span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="p">)</span>
    <span class="p">})</span>

<span class="n">detailed_tags</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">detailed_tags</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">detailed_tags</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>POS_TAG</th>
      <th>EXPLANATION</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>kind</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>in</th>
      <td>IN</td>
      <td>conjunction, subordinating or preposition</td>
    </tr>
    <tr>
      <th>glass</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CC</td>
      <td>conjunction, coordinating</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>cousin</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>,</th>
      <td>,</td>
      <td>punctuation mark, comma</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>spectacle</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CC</td>
      <td>conjunction, coordinating</td>
    </tr>
    <tr>
      <th>nothing</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>strange</th>
      <td>JJ</td>
      <td>adjective (English), other noun-modifier (Chin...</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>single</th>
      <td>JJ</td>
      <td>adjective (English), other noun-modifier (Chin...</td>
    </tr>
    <tr>
      <th>hurt</th>
      <td>JJ</td>
      <td>adjective (English), other noun-modifier (Chin...</td>
    </tr>
    <tr>
      <th>color</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CC</td>
      <td>conjunction, coordinating</td>
    </tr>
    <tr>
      <th>an</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>arrangement</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>in</th>
      <td>IN</td>
      <td>conjunction, subordinating or preposition</td>
    </tr>
    <tr>
      <th>a</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>system</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>to</th>
      <td>IN</td>
      <td>conjunction, subordinating or preposition</td>
    </tr>
    <tr>
      <th>pointing</th>
      <td>VBG</td>
      <td>verb, gerund or present participle</td>
    </tr>
    <tr>
      <th>.</th>
      <td>.</td>
      <td>punctuation mark, sentence closer</td>
    </tr>
    <tr>
      <th>All</th>
      <td>PDT</td>
      <td>predeterminer</td>
    </tr>
    <tr>
      <th>this</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>and</th>
      <td>CC</td>
      <td>conjunction, coordinating</td>
    </tr>
    <tr>
      <th>not</th>
      <td>RB</td>
      <td>adverb</td>
    </tr>
    <tr>
      <th>ordinary</th>
      <td>JJ</td>
      <td>adjective (English), other noun-modifier (Chin...</td>
    </tr>
    <tr>
      <th>,</th>
      <td>,</td>
      <td>punctuation mark, comma</td>
    </tr>
    <tr>
      <th>not</th>
      <td>RB</td>
      <td>adverb</td>
    </tr>
    <tr>
      <th>unordered</th>
      <td>JJ</td>
      <td>adjective (English), other noun-modifier (Chin...</td>
    </tr>
    <tr>
      <th>in</th>
      <td>IN</td>
      <td>conjunction, subordinating or preposition</td>
    </tr>
    <tr>
      <th>not</th>
      <td>RB</td>
      <td>adverb</td>
    </tr>
    <tr>
      <th>resembling</th>
      <td>VBG</td>
      <td>verb, gerund or present participle</td>
    </tr>
    <tr>
      <th>.</th>
      <td>.</td>
      <td>punctuation mark, sentence closer</td>
    </tr>
    <tr>
      <th>The</th>
      <td>DT</td>
      <td>determiner</td>
    </tr>
    <tr>
      <th>difference</th>
      <td>NN</td>
      <td>noun, singular or mass</td>
    </tr>
    <tr>
      <th>is</th>
      <td>VBZ</td>
      <td>verb, 3rd person singular present</td>
    </tr>
    <tr>
      <th>spreading</th>
      <td>VBG</td>
      <td>verb, gerund or present participle</td>
    </tr>
    <tr>
      <th>.</th>
      <td>.</td>
      <td>punctuation mark, sentence closer</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="use-case-word-sense-disambiguation">
<h3><span class="section-number">2.4.1. </span>Use case: word sense disambiguation<a class="headerlink" href="#use-case-word-sense-disambiguation" title="Permalink to this headline">#</a></h3>
<p>This is all well and good in the abstract, but the power of POS tags lies in how they support other kinds of analysis. We’ll do a quick word sense disambiguation task here but will return to do something more complex in a little while.</p>
<p>Between the two strings:</p>
<ol class="simple">
<li><p>“I am not going to bank on that happening.”</p></li>
<li><p>“I went down to the river bank.”</p></li>
</ol>
<p>How can we tell which sense of the word “bank” is being used? Well, we can model each with <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> and see whether the POS tags for these two tokens match. If they don’t match, this will indicate that the tokens represent two different senses of the word “bank.”</p>
<p>All this can be accomplished with a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop and <code class="docutils literal notranslate"><span class="pre">nlp.pipe()</span></code>. The latter function enables you to process different documents with the <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> model all at once. This can be great for working with a large corpus, though note that, because <code class="docutils literal notranslate"><span class="pre">.pipe()</span></code> is meant to work on text at scale, it will return a generator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">banks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;I am not going to bank on that happening.&quot;</span><span class="p">,</span> <span class="s2">&quot;I went down to the river bank.&quot;</span><span class="p">]</span>

<span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">banks</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;generator object Language.pipe at 0x12e420f90&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">nlp</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">banks</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;bank&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">+ </span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>I am not going to bank on that happening.
+ bank: VB (verb, base form)

I went down to the river bank.
+ bank: NN (noun, singular or mass)
</pre></div>
</div>
</div>
</div>
<p>See how the tags differ between the two instances of “bank”? This indicates a difference in usage and, by proxy, a difference in meaning.</p>
</section>
</section>
<section id="dependency-parsing">
<h2><span class="section-number">2.5. </span>Dependency Parsing<a class="headerlink" href="#dependency-parsing" title="Permalink to this headline">#</a></h2>
<p>Another tool that can help with tasks like disambiguating word sense is dependency parsing. We’ve actually used it already: it allowed us to extract those noun chunks above. Dependency parsing involves analyzing the grammatical structure of text (usually sentences) to identify relationships between the words therein. The basic idea is that every word in a linguistic unit (eg. a sentence) is linked to at least one other word via a tree structure, and these linkages are hierarchical in nature, with various modifications occuring across the levels of sentences, clauses, phrases, and even compound nouns. Dependency parsing can tell you information about:</p>
<ol class="simple">
<li><p>The primary <strong>subject</strong> of a linguistic unit (and whether it is an <strong>active</strong> or <strong>passive</strong> subject)</p></li>
<li><p>Various <strong>heads</strong>, which determine the syntatic categories of a phrase; these are often nouns and verbs, and you can think of them as the local subjects of subunits</p></li>
<li><p>Various <strong>dependents</strong>, which modify, either directly or indirectly, their heads (think adjectives, adverbs, etc.)</p></li>
<li><p>The <strong>root</strong> of the unit, which is often (<a class="reference external" href="https://universaldependencies.org/u/dep/root.html">but not always!</a>) the primary verb</p></li>
</ol>
<p>Linguists have developed a number of different methods to parse dependencies, which we won’t discuss here. Take note though that most popular one in NLP is the <a class="reference external" href="https://universaldependencies.org">Universal Dependencies</a> framework; <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>, like most NLP models, uses this. The library also has some functionality for visualizing dependencies, which will help clarify what it is they are in the first place. Below, we visualize a sentence from the Stein poem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spacy</span> <span class="kn">import</span> <span class="n">displacy</span>

<span class="n">to_render</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">carafe</span><span class="o">.</span><span class="n">sents</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">displacy</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">to_render</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;dep&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span class="tex2jax_ignore"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:lang="en" id="c8fa38e151db4f57a1bab36ca1ac132a-0" class="displacy" width="750" height="312.0" direction="ltr" style="max-width: none; height: 312.0px; color: #000000; background: #ffffff; font-family: Arial; direction: ltr">
<text class="displacy-token" fill="currentColor" text-anchor="middle" y="222.0">
    <tspan class="displacy-word" fill="currentColor" x="50">The</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="50">DET</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="222.0">
    <tspan class="displacy-word" fill="currentColor" x="225">difference</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="225">NOUN</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="222.0">
    <tspan class="displacy-word" fill="currentColor" x="400">is</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="400">AUX</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="222.0">
    <tspan class="displacy-word" fill="currentColor" x="575">spreading.</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="575">VERB</tspan>
</text>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-c8fa38e151db4f57a1bab36ca1ac132a-0-0" stroke-width="2px" d="M70,177.0 C70,89.5 220.0,89.5 220.0,177.0" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px">
        <textPath xlink:href="#arrow-c8fa38e151db4f57a1bab36ca1ac132a-0-0" class="displacy-label" startOffset="50%" side="left" fill="currentColor" text-anchor="middle">det</textPath>
    </text>
    <path class="displacy-arrowhead" d="M70,179.0 L62,167.0 78,167.0" fill="currentColor"/>
</g>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-c8fa38e151db4f57a1bab36ca1ac132a-0-1" stroke-width="2px" d="M245,177.0 C245,2.0 575.0,2.0 575.0,177.0" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px">
        <textPath xlink:href="#arrow-c8fa38e151db4f57a1bab36ca1ac132a-0-1" class="displacy-label" startOffset="50%" side="left" fill="currentColor" text-anchor="middle">nsubj</textPath>
    </text>
    <path class="displacy-arrowhead" d="M245,179.0 L237,167.0 253,167.0" fill="currentColor"/>
</g>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-c8fa38e151db4f57a1bab36ca1ac132a-0-2" stroke-width="2px" d="M420,177.0 C420,89.5 570.0,89.5 570.0,177.0" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 0.8em; letter-spacing: 1px">
        <textPath xlink:href="#arrow-c8fa38e151db4f57a1bab36ca1ac132a-0-2" class="displacy-label" startOffset="50%" side="left" fill="currentColor" text-anchor="middle">aux</textPath>
    </text>
    <path class="displacy-arrowhead" d="M420,179.0 L412,167.0 428,167.0" fill="currentColor"/>
</g>
</svg></span></div></div>
</div>
<p>See how the arcs have arrows? Arrows point to the dependents within a linguistic unit, that is, they point to modifying relationships between words. Arrows arc out from a segment’s head, and the relationships they indicate are all specified with labels. As with the POS tags, you can use <code class="docutils literal notranslate"><span class="pre">spacy.explain()</span></code> on the dependency labels, which we’ll do below. The whole list of them is also available in this <a class="reference external" href="https://universaldependencies.org/u/dep/all.html">table of typologies</a>. Finally, somewhere in the tree you’ll find a word with no arrows pointing to it (here, “spreading”). This is the root. One of its dependents is the subject of the sentence (here, “difference”).</p>
<p>Seeing these relationships are quite useful in and of themselves, but the real power of dependency parsing comes in all the extra data it can provide about a token. Using this technique, you can link tokens back to their heads, or find local groupings of tokens that all refer to the same head.</p>
<p>Here’s how you could formalize that with a dataframe. Given this sentence:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sentence</span> <span class="o">=</span> <span class="n">odyssey</span><span class="p">[</span><span class="mi">2246</span><span class="p">:</span><span class="mi">2260</span><span class="p">]</span>
<span class="n">sentence</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;Then I tried to find some way of embracing my mother&#39;s ghost.&quot;
</pre></div>
</div>
</div>
</div>
<p>We can construct a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop, which rolls through each token and retrieves its dependency info.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">:</span>
    <span class="n">dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;INDEX&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
        <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s1">&#39;DEPENDENCY_SHORTCODE&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">dep_</span><span class="p">,</span>
        <span class="s1">&#39;DEPENDENCY&#39;</span><span class="p">:</span> <span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">dep_</span><span class="p">),</span>
        <span class="s1">&#39;HEAD_INDEX&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
        <span class="s1">&#39;HEAD&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">head</span>
    <span class="p">})</span>
    
<span class="n">dependencies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dependencies</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;INDEX&#39;</span><span class="p">)</span>
<span class="n">dependencies</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/tyler/Environments/nlp/lib/python3.9/site-packages/spacy/glossary.py:19: UserWarning: [W118] Term &#39;ROOT&#39; not found in glossary. It may however be explained in documentation for the corpora used to train the language. Please check `nlp.meta[&quot;sources&quot;]` for any relevant links.
  warnings.warn(Warnings.W118.format(term=term))
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TOKEN</th>
      <th>DEPENDENCY_SHORTCODE</th>
      <th>DEPENDENCY</th>
      <th>HEAD_INDEX</th>
      <th>HEAD</th>
    </tr>
    <tr>
      <th>INDEX</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2246</th>
      <td>Then</td>
      <td>advmod</td>
      <td>adverbial modifier</td>
      <td>2248</td>
      <td>tried</td>
    </tr>
    <tr>
      <th>2247</th>
      <td>I</td>
      <td>nsubj</td>
      <td>nominal subject</td>
      <td>2248</td>
      <td>tried</td>
    </tr>
    <tr>
      <th>2248</th>
      <td>tried</td>
      <td>ROOT</td>
      <td>None</td>
      <td>2248</td>
      <td>tried</td>
    </tr>
    <tr>
      <th>2249</th>
      <td>to</td>
      <td>aux</td>
      <td>auxiliary</td>
      <td>2250</td>
      <td>find</td>
    </tr>
    <tr>
      <th>2250</th>
      <td>find</td>
      <td>xcomp</td>
      <td>open clausal complement</td>
      <td>2248</td>
      <td>tried</td>
    </tr>
    <tr>
      <th>2251</th>
      <td>some</td>
      <td>det</td>
      <td>determiner</td>
      <td>2252</td>
      <td>way</td>
    </tr>
    <tr>
      <th>2252</th>
      <td>way</td>
      <td>dobj</td>
      <td>direct object</td>
      <td>2250</td>
      <td>find</td>
    </tr>
    <tr>
      <th>2253</th>
      <td>of</td>
      <td>prep</td>
      <td>prepositional modifier</td>
      <td>2252</td>
      <td>way</td>
    </tr>
    <tr>
      <th>2254</th>
      <td>embracing</td>
      <td>pcomp</td>
      <td>complement of preposition</td>
      <td>2253</td>
      <td>of</td>
    </tr>
    <tr>
      <th>2255</th>
      <td>my</td>
      <td>poss</td>
      <td>possession modifier</td>
      <td>2256</td>
      <td>mother</td>
    </tr>
    <tr>
      <th>2256</th>
      <td>mother</td>
      <td>poss</td>
      <td>possession modifier</td>
      <td>2258</td>
      <td>ghost</td>
    </tr>
    <tr>
      <th>2257</th>
      <td>'s</td>
      <td>case</td>
      <td>case marking</td>
      <td>2256</td>
      <td>mother</td>
    </tr>
    <tr>
      <th>2258</th>
      <td>ghost</td>
      <td>dobj</td>
      <td>direct object</td>
      <td>2254</td>
      <td>embracing</td>
    </tr>
    <tr>
      <th>2259</th>
      <td>.</td>
      <td>punct</td>
      <td>punctuation</td>
      <td>2248</td>
      <td>tried</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>How many tokens are associated with each head?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dependencies</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;HEAD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HEAD
tried        5
find         2
way          2
of           1
embracing    1
mother       2
ghost        1
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Which tokens are in each of these groups?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;HEAD&#39;</span><span class="p">):</span>
    <span class="n">head</span><span class="p">,</span> <span class="n">tokens</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">group</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;HEAD&#39;</span><span class="p">:</span> <span class="n">head</span><span class="p">,</span>
        <span class="s1">&#39;GROUP&#39;</span><span class="p">:</span> <span class="n">tokens</span>
    <span class="p">})</span>
    
<span class="n">groups</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;HEAD&#39;</span><span class="p">)</span>
<span class="n">groups</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GROUP</th>
    </tr>
    <tr>
      <th>HEAD</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>tried</th>
      <td>[Then, I, tried, find, .]</td>
    </tr>
    <tr>
      <th>find</th>
      <td>[to, way]</td>
    </tr>
    <tr>
      <th>way</th>
      <td>[some, of]</td>
    </tr>
    <tr>
      <th>of</th>
      <td>[embracing]</td>
    </tr>
    <tr>
      <th>embracing</th>
      <td>[ghost]</td>
    </tr>
    <tr>
      <th>mother</th>
      <td>[my, 's]</td>
    </tr>
    <tr>
      <th>ghost</th>
      <td>[mother]</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">spaCy</span></code> also has a special <code class="docutils literal notranslate"><span class="pre">.subtree</span></code> attribute for each token, which will also produce a similar set of local groupings. Note however that <code class="docutils literal notranslate"><span class="pre">.subtree</span></code> captures all tokens that hold a dependent relationship with the one in question, meaning that when you find the subtree of the root, you’re going to print out the entire sentence.</p>
<p>As you might expect by now, <code class="docutils literal notranslate"><span class="pre">.subtree</span></code> returns a generator, so convert it to a list or use list comprehension to extract the tokens. We’ll do this in a separate function. Within this function, we’re going to use the <code class="docutils literal notranslate"><span class="pre">.text_with_ws</span></code> attribute of each token in the subtree to return an exact, string-like representation of the tree (this will include any whitespace characters that are attached to a token).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">subtree_to_text</span><span class="p">(</span><span class="n">subtree</span><span class="p">):</span>
    <span class="n">subtree</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">text_with_ws</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">token</span><span class="o">.</span><span class="n">subtree</span><span class="p">])</span>
    <span class="n">subtree</span> <span class="o">=</span> <span class="n">subtree</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">subtree</span>

<span class="n">sentence_trees</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">:</span>
    <span class="n">subtree</span> <span class="o">=</span> <span class="n">subtree_to_text</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">subtree</span><span class="p">)</span>
    <span class="n">sentence_trees</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
        <span class="s1">&#39;DEPENDENCY&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">dep_</span><span class="p">,</span>
        <span class="s1">&#39;SUBTREE&#39;</span><span class="p">:</span> <span class="n">subtree</span>
    <span class="p">})</span>

<span class="n">sentence_trees</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sentence_trees</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">sentence_trees</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DEPENDENCY</th>
      <th>SUBTREE</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Then</th>
      <td>advmod</td>
      <td>Then</td>
    </tr>
    <tr>
      <th>I</th>
      <td>nsubj</td>
      <td>I</td>
    </tr>
    <tr>
      <th>tried</th>
      <td>ROOT</td>
      <td>"Then I tried to find some way of embracing my...</td>
    </tr>
    <tr>
      <th>to</th>
      <td>aux</td>
      <td>to</td>
    </tr>
    <tr>
      <th>find</th>
      <td>xcomp</td>
      <td>to find some way of embracing my mother's ghost</td>
    </tr>
    <tr>
      <th>some</th>
      <td>det</td>
      <td>some</td>
    </tr>
    <tr>
      <th>way</th>
      <td>dobj</td>
      <td>some way of embracing my mother's ghost</td>
    </tr>
    <tr>
      <th>of</th>
      <td>prep</td>
      <td>of embracing my mother's ghost</td>
    </tr>
    <tr>
      <th>embracing</th>
      <td>pcomp</td>
      <td>embracing my mother's ghost</td>
    </tr>
    <tr>
      <th>my</th>
      <td>poss</td>
      <td>my</td>
    </tr>
    <tr>
      <th>mother</th>
      <td>poss</td>
      <td>my mother's</td>
    </tr>
    <tr>
      <th>'s</th>
      <td>case</td>
      <td>'s</td>
    </tr>
    <tr>
      <th>ghost</th>
      <td>dobj</td>
      <td>my mother's ghost</td>
    </tr>
    <tr>
      <th>.</th>
      <td>punct</td>
      <td>.</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="putting-everything-together">
<h2><span class="section-number">2.6. </span>Putting Everything Together<a class="headerlink" href="#putting-everything-together" title="Permalink to this headline">#</a></h2>
<p>Now that we’ve walked through all these options (which are really only a small sliver of what you can do with <code class="docutils literal notranslate"><span class="pre">spaCy</span></code>!), let’s put them into action. Below, we’ll construct two short examples of how you might combine different aspects of token attributes to analyze a text. Both of them are essentially <strong>information retrieval</strong> tasks, and you might imagine doing something similar to extract and analyze particular words in your corpus, or to find different grammatical patterns that could be of significance (as we’ll discuss in the next session).</p>
<section id="finding-lemmas">
<h3><span class="section-number">2.6.1. </span>Finding lemmas<a class="headerlink" href="#finding-lemmas" title="Permalink to this headline">#</a></h3>
<p>In the first, we’ll use the <code class="docutils literal notranslate"><span class="pre">.lemma_</span></code> attribute to search through Book XI of <em>The Odyssey</em> and match its tokens to a few key words. If you’ve read <em>The Odyssey</em>, you’ll know that Book XI is where Odysseus and his fellow sailors have to travel down to the underworld Hades, where they speak with the dead. We already saw one example of this: Odysseus attempts to embrace his dead mother after communing with her. The whole trip to Hades is an emotionally tumultuous experience for the travelers, and peppered throughout Book XI are expressions of grief.</p>
<p>With <code class="docutils literal notranslate"><span class="pre">.lemma_</span></code>, we can search for these expressions. We’ll roll through the text and determine whether a token lemma matches one of a selected set. When we find a match, we’ll get the subtree of this token’s <em>head</em>. That is, we’ll find the head upon which this token depends, and then we’ll use that to reconstruct the local context for the token.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sorrowful_lemmas</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">odyssey</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">lemma_</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;cry&#39;</span><span class="p">,</span> <span class="s1">&#39;grief&#39;</span><span class="p">,</span> <span class="s1">&#39;grieve&#39;</span><span class="p">,</span> <span class="s1">&#39;sad&#39;</span><span class="p">,</span> <span class="s1">&#39;sorrow&#39;</span><span class="p">,</span> <span class="s1">&#39;tear&#39;</span><span class="p">,</span> <span class="s1">&#39;weep&#39;</span><span class="p">):</span>
        <span class="n">subtree</span> <span class="o">=</span> <span class="n">subtree_to_text</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">subtree</span><span class="p">)</span>
        <span class="n">sorrowful_lemmas</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;TOKEN&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;SUBTREE&#39;</span><span class="p">:</span> <span class="n">subtree</span>
        <span class="p">})</span>

<span class="n">sorrowful_lemmas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sorrowful_lemmas</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">sorrowful_lemmas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SUBTREE</th>
    </tr>
    <tr>
      <th>TOKEN</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>cried</th>
      <td>cried when I saw him: 'Elpenor</td>
    </tr>
    <tr>
      <th>sad</th>
      <td>sad</td>
    </tr>
    <tr>
      <th>tears</th>
      <td>tears</td>
    </tr>
    <tr>
      <th>sorrow</th>
      <td>all my sorrow</td>
    </tr>
    <tr>
      <th>sad</th>
      <td>sad</td>
    </tr>
    <tr>
      <th>tears</th>
      <td>tears both night and day</td>
    </tr>
    <tr>
      <th>grieves</th>
      <td>He grieves continually about your never having...</td>
    </tr>
    <tr>
      <th>sad</th>
      <td>sad</td>
    </tr>
    <tr>
      <th>sorrows</th>
      <td>our sorrows</td>
    </tr>
    <tr>
      <th>grief</th>
      <td>grief</td>
    </tr>
    <tr>
      <th>grief</th>
      <td>great grief for the spite the gods had borne him</td>
    </tr>
    <tr>
      <th>grief</th>
      <td>grief</td>
    </tr>
    <tr>
      <th>sadder</th>
      <td>still sadder</td>
    </tr>
    <tr>
      <th>weeping</th>
      <td>weeping</td>
    </tr>
    <tr>
      <th>wept</th>
      <td>I too wept and pitied him as I beheld him</td>
    </tr>
    <tr>
      <th>weeping</th>
      <td>weeping and talking thus sadly with one anothe...</td>
    </tr>
    <tr>
      <th>tear</th>
      <td>a tear</td>
    </tr>
    <tr>
      <th>cries</th>
      <td>such appalling cries</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="verb-subject-relations">
<h3><span class="section-number">2.6.2. </span>Verb-subject relations<a class="headerlink" href="#verb-subject-relations" title="Permalink to this headline">#</a></h3>
<p>For this next example, we’ll use dependency tags to find the subject sentences in Book XI. As before, we’ll go through each token in the document, this time checking to see whether it has the <code class="docutils literal notranslate"><span class="pre">nsubj</span></code> or <code class="docutils literal notranslate"><span class="pre">nsubjpass</span></code> tag for its <code class="docutils literal notranslate"><span class="pre">.dep_</span></code> attribute, which denote the subjects of the sentence’s root. We’ll also check to see whether a token is a noun (otherwise we’d get a lot of articles like “who,” “them,” etc.). If a token matches these two conditions, we’ll find its head verb as well as the token’s subtree. Note that this time, the subtree will refer directly to the token in question, not to the head. This will let us capture some descriptive information about each sentence subject.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsubj</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">odyssey</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">dep_</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;nsubj&#39;</span><span class="p">,</span> <span class="s1">&#39;nsubjpass&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">pos_</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;NOUN&#39;</span><span class="p">,</span> <span class="s1">&#39;PROPN&#39;</span><span class="p">):</span>
        <span class="n">nsubj</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;SUBJECT&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;HEAD&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;HEAD_LEMMA&#39;</span><span class="p">:</span> <span class="n">token</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">lemma_</span><span class="p">,</span>
            <span class="s1">&#39;SUBTREE&#39;</span><span class="p">:</span> <span class="n">subtree_to_text</span><span class="p">(</span><span class="n">token</span><span class="o">.</span><span class="n">subtree</span><span class="p">)</span>
        <span class="p">})</span>

<span class="n">nsubj_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">nsubj</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;SUBJECT&#39;</span><span class="p">)</span>
<span class="n">nsubj_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>HEAD</th>
      <th>HEAD_LEMMA</th>
      <th>SUBTREE</th>
    </tr>
    <tr>
      <th>SUBJECT</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Circe</th>
      <td>sent</td>
      <td>send</td>
      <td>Circe, that great and cunning goddess,</td>
    </tr>
    <tr>
      <th>sails</th>
      <td>were</td>
      <td>be</td>
      <td>her sails</td>
    </tr>
    <tr>
      <th>sun</th>
      <td>went</td>
      <td>go</td>
      <td>the sun</td>
    </tr>
    <tr>
      <th>darkness</th>
      <td>was</td>
      <td>be</td>
      <td>darkness</td>
    </tr>
    <tr>
      <th>rays</th>
      <td>pierce</td>
      <td>pierce</td>
      <td>the rays of the sun</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>Mercury</th>
      <td>helped</td>
      <td>help</td>
      <td>Mercury and Minerva</td>
    </tr>
    <tr>
      <th>thousands</th>
      <td>came</td>
      <td>come</td>
      <td>so many thousands of ghosts</td>
    </tr>
    <tr>
      <th>Proserpine</th>
      <td>send</td>
      <td>send</td>
      <td>Proserpine</td>
    </tr>
    <tr>
      <th>ship</th>
      <td>went</td>
      <td>go</td>
      <td>the ship</td>
    </tr>
    <tr>
      <th>wind</th>
      <td>sprang</td>
      <td>spring</td>
      <td>a fair wind</td>
    </tr>
  </tbody>
</table>
<p>140 rows × 3 columns</p>
</div></div></div>
</div>
<p>Let’s look at a few subtrees. Note how sometimes they are simple noun chunks, while in other cases they expand to whole phrases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">nsubj_df</span><span class="p">[</span><span class="s1">&#39;SUBTREE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;+ </span><span class="si">{</span><span class="n">chunk</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>+ the people
+ My mother
+ Telemachus
+ the gods
+ Tityus son of Gaia
+ your enemies
+ Penelope
+ Circe
+ King Alcinous
+ the ghost of my dead mother Anticlea, daughter to Autolycus
</pre></div>
</div>
</div>
</div>
<p>Time to zoom out. How many time do each of our selected subjects appear?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsubj_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;SUBJECT&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SUBJECT
ghost         6
heaven        4
Proserpine    4
ghosts        4
wife          4
man           4
one           4
Ulysses       4
people        3
judgement     2
gods          2
life          2
mother        2
creature      2
son           2
Teiresias     2
ship          2
Jove          2
wind          2
Neleus        2
will          2
Circe         2
sweat         1
others        1
wave          1
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>What heads are associated with each subject? (Note that we’re using the lemmatized form of the verbs.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsubj_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;SUBJECT&#39;</span><span class="p">,</span> <span class="s1">&#39;HEAD_LEMMA&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SUBJECT       HEAD_LEMMA
Ulysses       answer        2
ghost         come          2
son           be            2
Proserpine    send          2
people        hear          1
              bless         1
              be            1
others        fall          1
one           tell          1
man           kill          1
one           invite        1
prisoners     be            1
prophecyings  speak         1
one           get           1
              be            1
mother        come          1
              answer        1
match         marry         1
Aegisthus     be            1
queen         say           1
judgement     rankle        1
heaven        make          1
              take          1
              vouchsafe     1
heroes        lie           1
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Such information provides another way of looking at something like topicality. Rather than using, say, a bag of words approach to build a topic model, you could instead segment your text into chunks like the above and start tallying up token distributions. Such distributions might help you identify the primary subject in a passage of text, whether that be a character or something like a concept. Or, you could leverage them to investigate how different subjects are talked about, say by throwing POS tags into the mix to further nuance relationships across entities.</p>
<p>Our next session will demonstrate what such investigations look like in action. For now however, the main takeway is that the above annotation structures provide you with a host of different ways to segment and facet your text data. You are by no means limited to single token counts when working computationally analyzing text. Indeed, sometimes the most compelling ways to expore a corpus lie in the broader, fuzzier relationships that NLP annotations help us identify.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "nlp"
        },
        kernelOptions: {
            kernelName: "nlp",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'nlp'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="01_logistics.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">1. </span>Before We Begin…</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="03_classification-and-feature-engineering.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">3. </span>Classification and Feature Engineering</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Tyler Shoemaker and Carl Stahmer<br/>
  
    <div class="extra_footer">
      <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">
  <img alt="CC BY-SA 4.0" src="https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg"> 
</a>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>